## ì˜¤ë¸Œì íŠ¸ì™€ ì˜ì¡´ê´€ê³„ STUDY
***

## ğŸ¯ ëª©ì°¨
#### ğŸ“Œ ìŠ¤í”„ë§ì˜ ì§€í–¥ì 
#### ğŸ“Œ ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬
#### ğŸ“Œ ì œì–´ì˜ ì—­ì „ (IOC)
#### ğŸ“Œ ìŠ¤í”„ë§ IOC
#### ğŸ“Œ ì‹±ê¸€í†¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬
#### ğŸ“Œ ì˜ì¡´ê´€ê³„ ì£¼ì…(DI)
***
## ğŸš€ ìŠ¤í”„ë§ì˜ ì§€í–¥ì 
**ìŠ¤í”„ë§ì€ ìë°”ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ê¸°ìˆ !**
- ìë°”ì—ì„œ ê°€ì¥ ì¤‘ìš”í•˜ê²Œ ê°€ì¹˜ë¥¼ ë‘ëŠ” ê²ƒì€ ê°ì²´ì§€í–¥
  - So, ìŠ¤í”„ë§ì´ ê°€ì¥ ê´€ì‹¬ì„ ë§ì´ ë‘ëŠ” ëŒ€ìƒì€ ì˜¤ë¸Œì íŠ¸ ì…ë‹ˆë‹¤.
  ìŠ¤í”„ë§ì„ ì´í•´í•˜ë ¤ë©´ ë¨¼ì € ì˜¤ë¸Œì íŠ¸ì— ê¹Šì€ ê´€ì‹¬ì„ ê°€ì ¸ì•¼ í•˜ë©°, ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì˜¤ë¸Œì íŠ¸ê°€ ìƒì„±ë˜ê³ 
  ë‹¤ë¥¸ ì˜¤ë¸Œì íŠ¸ì™€ ê´€ê³„ë¥¼ ë§ºê³ , ì‚¬ìš©ë˜ê³ , ì†Œë©¸í•˜ê¸°ê¹Œì§€ì˜ ì „ ê³¼ì •ì„ ì´í•´í•˜ê³  ìˆì–´ì•¼í•©ë‹ˆë‹¤.
  
  - ì˜¤ë¸Œì íŠ¸ì— ëŒ€í•œ ê´€ì‹¬ì€ ì˜¤ë¸Œì íŠ¸ì˜ ì„¤ê³„ì— ëŒ€í•œ ê´€ì‹¬ìœ¼ë¡œ ë°œì „
    - ë‹¤ì–‘í•œ ëª©ì ì„ ìœ„í•´ ì¬í™œìš© ê°€ëŠ¥í•œ ì„¤ê³„ ë°©ë²•ì¸ ë””ìì¸ íŒ¨í„´
    - ì¢€ ë” ê¹”ë”í•œ êµ¬ì¡°ê°€ ë˜ë„ë¡ ì§€ì†ì ìœ¼ë¡œ ê°œì„ í•´ë‚˜ê°€ëŠ” ì‘ì—…ì¸ ë¦¬íŒ©í† ë§
    - í…ŒìŠ¤íŠ¸
    
- ê°ì²´ì§€í–¥ ê¸°ìˆ ê³¼ ì„¤ê³„, êµ¬í˜„ì— ê´€í•œ ì‹¤ìš©ì ì¸ ì „ëµì„ ê°œë°œìë“¤ì´ ìì—°ìŠ¤ëŸ½ê³  ì†ì‰½ê²Œ ì ìš©í•  ìˆ˜ ìˆë„ë¡ í”„ë ˆì„ì›Œí¬ í˜•íƒœë¡œ ì œê³µ
  

***
## ğŸš€ ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬

### ğŸ” í…ŒìŠ¤íŠ¸ ë‚´ìš©

**ì•„ë˜ì˜ 3ê°€ì§€ `repository`, `service`, `domain` ì„ í™œìš©í•˜ì—¬ ì•„ë¬´ ì„¤ì •ë„ ì•ˆë˜ì–´ ìˆëŠ” ë‚œê°í•œ
ìƒíƒœì—ì„œ ì œê°€ í•™ìŠµí•œ ë‚˜ë¦„ëŒ€ë¡œ Ver 1. ë¶€í„° Ver 5. ê¹Œì§€ì˜ ìŠ¤í”„ë§ì´ ì§€í–¥í•˜ëŠ” ìƒíƒœë¡œì˜ ë°œì „ì„ ë³´ì—¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤.**
- ì‚¬ìš©ì ì •ë³´ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•  `repository`
  - í¸ì˜ë¥¼ ìœ„í•´ `JPA`ë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
- ë„ë©”ì¸ ì •ë³´ë¥¼ í™œìš©í•˜ì—¬ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë‹´ë‹¹í•  `service`
- ìœ ì € ì •ë³´ë¥¼ ë‹´ê³  ìˆëŠ” `domain`

**User.java (ëª¨ë“  Version ì—ì„œ ì‚¬ìš©í•  ë„ë©”ì¸)**
```java
@Getter
@Entity
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class User {

    @Id @GeneratedValue
    @Column(name="user_id")
    private Long id;

    private String name;
    private String password;

    @Builder(builderMethodName = "createUser")
    public User(String name,String password){
        this.name=name;
        this.password=password;
    }

}
```

### ğŸ”§ Version 1. 
- `repository` í´ë˜ìŠ¤ë§Œ ì¡´ì¬

**UserRepositoryV1.java**

```java
import org.springframework.transaction.annotation.Transactional;

@RequiredArgsConstructor
@Transactional
public class UserRepositoryV1 {

  private final EntityManager em;

  public Long join(User user) {
    return save(user);
  }

  public User findOne(Long userId) {
    Optional<User> findUser = findById(userId);

    return findUser.orElseThrow(() -> {
              throw new RuntimeException();
            }
    );
  }

  public Long save(User user) {
    em.persist(user);
    return user.getId();
  }

  public Optional<User> findById(Long id) {
    return Optional.ofNullable(em.find(User.class, id));
  }

  public void remove(Long id) {
    User user = findOne(id);
    em.remove(user);
  }

}


```

**UserRepositoryV1Test.java(ë™ì‘ í™•ì¸)**
```java
@Transactional
@SpringBootTest
public class UserRepositoryV1Test {

  @Autowired
  EntityManager em;

  @Test
  @DisplayName("ë°ì´í„° ì €ì¥ í…ŒìŠ¤íŠ¸")
  void íšŒì›ì €ì¥_Test(){
    User user=User.createUser()
            .name("í™ì„±ì§„")
            .password("1234")
            .build();

    UserRepositoryV1 userRepository=new UserRepositoryV1(em);
    Long saveId = userRepository.save(user);

    User findUser = userRepository.findOne(saveId);

    Assertions.assertThat(findUser.getName()).isEqualTo(user.getName());
    Assertions.assertThat(findUser.getPassword()).isEqualTo(user.getPassword());
  }
}
```

**í…ŒìŠ¤íŠ¸ ê²°ê³¼**

<img width="50%" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-09-27 á„‹á…©á„’á…® 9 04 08" src="https://user-images.githubusercontent.com/56334761/134904927-cd84d2d8-0e8a-40c1-9a1f-4c0c8b3b089f.png">

**ì´ëŸ° ì‹ìœ¼ë¡œ `repository` í´ë˜ìŠ¤ë§Œ ë”± ì“°ëŠ” ê²ƒì€ ê°ì²´ì§€í–¥ê´€ì ì—ì„œ êµ‰ì¥í•œ ë¬¸ì œë¥¼ ì´ˆë˜í•œë‹¤ê³  í•©ë‹ˆë‹¤.**
- ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ” ê²ƒì´ í™•ì¸ ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¼ë° ë¬¸ì œê°€??!
- ë¬¸ì œë¥¼ ê°œì„ í–ˆì„ ë•Œì˜ ì¥ì ì€?
- ë¯¸ë˜ì— ì£¼ëŠ” ìœ ìµ?!

**ì´ëŸ¬í•œ ê³ ì°°(ì¢‹ì€ ê°ì²´ì§€í–¥ ì„¤ê³„)ì´ ìŠ¤í”„ë§ì„ í™œìš©í•œ ê°œë°œì˜ ì²« ê±¸ìŒì´ ë˜ì—ˆë‹¤ê³  í•©ë‹ˆë‹¤.**

- **ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬**
  - ê°ì²´ì§€í–¥ì˜ ì„¸ê³„ëŠ” ëª¨ë“  ê²ƒ(ì˜¤ë¸Œì íŠ¸ì— ëŒ€í•œ ì„¤ê³„ì™€ ì´ë¥¼ êµ¬í˜„í•œ ì½”ë“œ)ì´ ë³€í•¨.
    - ì‚¬ìš©ìì˜ ìš”êµ¬ì‚¬í•­ì— ë”°ë¼
    - ì‹œê°„ì´ ë³€í•¨ì— ë”°ë¼
    - ...
  - **So,** ê°œë°œìê°€ ê°ì²´ë¥¼ ì„¤ê³„í•  ë•Œ ê°€ì¥ ì—¼ë‘í•´ì•¼í•  ì‚¬í•­ì€ ë°”ë¡œ ë¯¸ë˜ì˜ ë³€í™”ë¥¼ ì–´ë–»ê²Œ ëŒ€ì²˜í•  ê²ƒì¸ê°€? ì…ë‹ˆë‹¤.
    - **ex)** ê¸°ëŠ¥ ë³€í™”ì— ëŒ€í•œ ìš”êµ¬ì‚¬í•­ì„ ë¯¸ë˜ë¥¼ ì˜ ëŒ€ë¹„í•œ ê°œë°œìëŠ” ë‹¨ì§€ ëª‡ ì¤„ì˜ ì½”ë“œ ìˆ˜ì • ë° ê²€ì¦ ê¹Œì§€ì˜ ì‹œê°„ì´ 5ë¶„ì´ì—ˆë‹¤ë©´,
    ë¯¸ë˜ë¥¼ ëŒ€ë¹„í•˜ì§€ ì•Šì€ ê°œë°œìëŠ” 5ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.
  - ê°ì²´ ì§€í–¥ ê¸°ìˆ ì€ ì¶”ìƒì„¸ê³„ë¥¼ ììœ ë¡­ê²Œ ë³€ê²½, í™•ì¥ì‹œí‚¬ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì— ì˜ë¯¸ê°€ ìˆìŠµë‹ˆë‹¤.
  - ë¶„ë¦¬ì™€ í™•ì¥ì„ ê³ ë ¤í•œ ì„¤ê³„ë¥¼ í•˜ë©´ í•„ìš”í•œ ì‘ì—…ì„ ìµœì†Œí™”í•˜ê³ , ë³€ê²½ì´ ë‹¤ë¥¸ ì‘ì—…ì— ë¬¸ì œë¥¼ ì¼ìœ¼í‚¤ì§€ ì•Šì„ ê²ƒì…ë‹ˆë‹¤.

- **ë¶„ë¦¬**
  - ëª¨ë“  ë³€ê²½ê³¼ ë°œì „ì€ í•œ ë²ˆì— í•œ ê°€ì§€ ê´€ì‹¬ì‚¬í•­ì— ì§‘ì¤‘í•´ì„œ ì¼ì–´ë‚©ë‹ˆë‹¤.
    - **ex)** DBì˜ ì ‘ì†ìš© ì•”í˜¸ë¥¼ ë³€ê²½í•˜ë¼
    - ì—¬ê¸°ì„œ ì¼ì–´ë‚˜ëŠ” ë¬¸ì œëŠ” ë³€í™”ì— ë”°ë¥¸ ì‘ì—…ì€ í•œ ê³³ì— ì§‘ì¤‘ë˜ì§€ ì•Šë‹¤ëŠ” ê²½ìš°ê°€ ë§ë“œëŠ” ê²ƒì…ë‹ˆë‹¤. ì¦‰, DB ì ‘ì† ì•”í˜¸ë¥¼ ë³€ê²½í•˜ê¸°ìœ„í•´ ìˆ˜ ë°±ê°œì˜ í´ë˜ìŠ¤ë¥¼
    ëŒì•„ë‹¤ë‹ˆë©°, í™•ì¸ì„ í•´ì•¼í•  ìˆ˜ë„ ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.
  - **So, ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´?** ê³µí†µ ê´€ì‹¬ì‚¬í•­ì„ ê°€ì§„ ê²ƒë“¤ì„ í•œ ê³³ì— ì§‘ì¤‘ì‹œí‚¤ë©´ ë©ë‹ˆë‹¤.
  - ê´€ì‹¬ì´ ê°™ì€ ê²ƒë¼ë¦¬ëŠ” í•˜ë‚˜ì˜ ê°ì²´ ì•ˆìœ¼ë¡œ , ë‹¤ë¥¸ ê²ƒì€ ë”°ë¡œ ë–¨ì–´ì ¸ ì„œë¡œ ì˜í–¥ì„ ë¼ì¹˜ì§€ ì•Šë„ë¡ í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
  
  - **ë¶„ë¦¬ì˜ ì˜ˆ**
    - ì¤‘ë³µ ì½”ë“œì˜ ë©”ì†Œë“œ ì¶”ì¶œ (ë¦¬íŒ©í† ë§ì˜ ë©”ì†Œë“œ ì¶”ì¶œ ê¸°ë²•)
      - ì´ì  : ë§Œì¼ ì¤‘ë³µ ì½”ë“œê°€ ìˆ˜ ì²œê°œì˜ ë©”ì†Œë“œì— í©ì–´ì ¸ ìˆë‹¤ê³  ìƒê°í•©ì‹œë‹¤. ê·¼ë°, ì¤‘ë³µ ì½”ë“œì— ëŒ€í•œ ë³€ê²½ì´ í•„ìš”í•˜ë‹¤ë©´?? ìˆ˜ ì²œê°œì˜ ë©”ì†Œë“œë¥¼
      ì¼ì¼íˆ ìˆ˜ì •í•˜ê³  ìˆì–´ì•¼í•  ê²ƒì…ë‹ˆë‹¤. ë§Œì¼ ì¤‘ë³µ ì½”ë“œë¥¼ ë©”ì†Œë“œë¡œ ì¶”ì¶œí•˜ì—¬ë†¨ìœ¼ë©´, ë”± í•œ ê³³ë§Œ ë°”ê¾¸ê¸°ë§Œ í•˜ë©´ ë˜ì£ ..
    

**ë§Œì•½, `repository`ì˜ ë¡œì§ì„ ìƒí™©ì— ë”°ë¼ ë°”ê¾¸ê³  ì‹¶ë‹¤ê³  ê°€ì •í•´ ë´…ì‹œë‹¤.**

í•˜ì§€ë§Œ, í˜„ì¬, Ver 1. ì—ì„œëŠ” `repository`í´ë˜ìŠ¤ í•˜ë‚˜ë¡œë§Œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì¦‰, ì‚¬ìš© ì‹œì ë§ˆë‹¤ ì›í•˜ëŠ” ë¡œì§ì— ëŒ€í•œ ì½”ë“œë¡œì˜ ë²ˆê±°ë¡œìš´ ìˆ˜ì •ì´
í•„ìš”í•˜ê²Œ ë©ë‹ˆë‹¤. ë˜í•œ, ì´ í´ë˜ìŠ¤ë¥¼ ê°œë°œí•œ ê°œë°œìê°€ ê·¸ë§Œë‘ê³  ë‹¤ë¥¸ ê°œë°œìê°€ ì´ì–´ì„œ ì‘ì—…ì„ í•œë‹¤ê³  ìƒê°í•œë‹¤ë©´, ì–´ëŠ ë¶€ë¶„ì„ ìˆ˜ì •í•´ì•¼ í•  ì§€ë„
ëª¨ë¥¼ ìˆ˜ ìˆìœ¼ë©° ê´€ì‹¬ì‚¬ê°€ ë‹¤ë¥¸ ë©”ì†Œë“œë“¤ì´ í•œ í´ë˜ìŠ¤ë‚´ì— ë‹¤ ì¡´ì¬í•˜ê³  ìˆìŠµë‹ˆë‹¤.

**ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°ì„ í•˜ê¸° ìœ„í•´ì„œ ê¸°ì¡´ ì½”ë“œë¥¼ ë¶„ë¦¬í•  ì‹œì ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤.**

### ğŸ”§ Version 2.
Version 1. ì—ì„œì˜ ì½”ë“œë¥¼ ë³´ì‹œë©´ í•œ ê°€ì§€ í´ë˜ìŠ¤ë‚´ì— ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•˜ëŠ” ë©”ì†Œë“œì™€ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì´ìš©í•˜ì—¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë‹´ë‹¹í•˜ê³  ìˆëŠ” ë©”ì†Œë“œê°€ ìˆìŠµë‹ˆë‹¤.
ì´ ë‘˜ì˜ ê´€ì‹¬ì‚¬ë¥¼ `repository` ì™€ `service`ë¡œ ë¶„ë¦¬ì‹œì¼œ ë´…ì‹œë‹¤.
ì–´ë–»ê²Œ í• ê¹Œìš”??!
- ìƒì†ì„ í†µí•œ í™•ì¥
 
**UserRepositoryV2.java**

```java
public abstract class UserServiceV2 {

  public Long join(User user){
    return save(user);
  }

  public User findOne(Long userId){
    Optional<User> findUser=findById(userId);

    return findUser.orElseThrow(()->{
              throw new RuntimeException();
            }
    );
  }
  public abstract Long save(User user);
  public abstract Optional<User> findById(Long userId);
  public abstract void remove(Long userId);
}

```

**UserRepositoryV2Extends.java**

```java
@RequiredArgsConstructor
public class UserRepositoryV2Extends extends UserServiceV2{

    private final EntityManager em;

    @Override
    public Long save(User user) {
        em.persist(user);
        return user.getId();
    }

    @Override
    public Optional<User> findById(Long userId) {
        return Optional.ofNullable(em.find(User.class,userId));
    }

    @Override
    public void remove(Long userId) {
        User findUser = findById(userId).orElse(null);

        if(findUser==null)
            throw  new IllegalArgumentException();

        em.remove(findUser);
    }
}
```

**UserServiceV2Test.java**

```java
@SpringBootTest
@Transactional
public class UserServiceV2Test {

  @Autowired
  EntityManager em;

  @Test
  @DisplayName("V2 test")
  void V2_í…ŒìŠ¤íŠ¸(){

    User user=createUser("hong","1234");

    UserServiceV2 userService=new UserRepositoryV2Extends(em);

    Long saveId = userService.join(user);

    User findUser = userService.findOne(saveId).get();

    Assertions.assertThat(findUser.getName()).isEqualTo(user.getName());
    Assertions.assertThat(findUser.getPassword()).isEqualTo(user.getPassword());
  }

  private User createUser(String name, String password){
    return User.createUser()
            .name(name)
            .password(password)
            .build();
  }
}
```

**í…ŒìŠ¤íŠ¸ ê²°ê³¼**

<img width="50%" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-09-28 á„‹á…©á„’á…® 5 33 37" src="https://user-images.githubusercontent.com/56334761/135062980-7c4e4236-43ad-48e1-8ff4-e6e0d792cba9.png">

**ì¶”ìƒ í´ë˜ìŠ¤ë¥¼ í™œìš©í•˜ì—¬ `repository`ì˜ ë³€ê²½ ì‘ì—…ì„ í•œì¸µ ë” ìš©ì´í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.**
- ë‹¨ìˆœíˆ ë³€ê²½ ì´ìƒìœ¼ë¡œ ì†ì‰½ê²Œ í™•ì¥í•  ìˆ˜ ë„ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.
- ì´ì œëŠ” `repository`í´ë˜ìŠ¤ì˜ ì½”ë“œë¥¼ ë³€ê²½í•  í•„ìš”ì—†ì´ ê¸°ëŠ¥ì„ ìƒˆë¡­ê²Œ ì •ì˜í•œ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ğŸ‘ í…œí”Œë¦¿ ë©”ì†Œë“œ íŒ¨í„´**
>ê¸°ë³¸ì ì¸ ë¡œì§ì˜ íë¦„ì„ ë§Œë“¤ê³ , ê·¸ ê¸°ëŠ¥ì˜ ì¼ë¶€ë¥¼ ì¶”ìƒ ë©”ì†Œë“œë‚˜ ì˜¤ë²„ë¼ì´ë”©ì´ ê°€ëŠ¥í•œ ë©”ì†Œë“œ ë“±ìœ¼ë¡œ ë§Œë“  ë’¤
ì„œë¸Œí´ë˜ìŠ¤ì—ì„œ ì´ëŸ° ë©”ì†Œë“œë¥¼ í•„ìš”ì— ë§ê²Œ êµ¬í˜„í•´ì„œ ì‚¬ìš©í•˜ë„ë¡ í•˜ëŠ” ë°©ë²•ì„ ë””ìì¸ íŒ¨í„´ì—ì„œ í…œí”Œë¦¿ ë©”ì†Œë“œ íŒ¨í„´ì´ë¼ê³  í•©ë‹ˆë‹¤.

**BUT, ë³€ê²½ ë° í™•ì¥ì´ ìš©ì´í•´ì¡Œì§€ë§Œ ìƒì†ì„ í™œìš©í–ˆë‹¤ëŠ” ë‹¨ì ì´ ì¡´ì¬**
- ìë°”ëŠ” ë‹¤ì¤‘ìƒì† í—ˆìš© ê¸ˆì§€.
- ì„œë¸Œ í´ë˜ìŠ¤ê°€ ìŠˆí¼ í´ë˜ìŠ¤ì˜ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ.
  - ìŠˆí¼ í´ë˜ìŠ¤ ë‚´ë¶€ì˜ ë³€ê²½ì´ ìˆì„ ë•Œ, ëª¨ë“  ì„œë¸Œí´ë˜ìŠ¤ì˜ ë‚´ìš©ì„ ìˆ˜ì •í•´ì•¼í•  ìˆ˜ë„ ìˆìŒ. ì¦‰, ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬ê°€ ì™„ë²½í•˜ì§€ ì•Šë‹¤ëŠ” ëœ».

### ğŸ”§ Version 3.
- ë…ë¦½ì ì¸ í´ë˜ìŠ¤ë¡œ ë¶„ë¦¬í•˜ì—¬ ê´€ì‹¬ì‚¬ë¥¼ ë¶„ë¦¬
  - `repository` ê´€ë ¨ëœ ë¶€ë¶„ì„ ìƒì†í´ë˜ìŠ¤ê°€ ì•„ë‹Œ ì•„ì˜ˆ ë³„ë„ì˜ í´ë˜ìŠ¤ë¡œ ë§Œë“¤ì–´ë´…ì‹œë‹¤.

**UserRepositoryV3.java**
```java
@RequiredArgsConstructor
public class UserRepositoryV3 {

    private final EntityManager em;

    public Long save(User user){
        em.persist(user);
        return user.getId();
    }

    public void remove(Long id){
        User findUser = findById(id).orElse(null);
        if(findUser==null)
            throw  new IllegalArgumentException();
        em.remove(findUser);
    }
    public Optional<User> findById(Long id){
        return Optional.ofNullable(em.find(User.class,id));
    }
    public Optional<User> findByName(String name){
        return Optional.ofNullable(em.createQuery("select u from User u where u.name=:name",User.class)
                .setParameter("name",name)
                .getSingleResult());
    }

}
```

**UserServiceV3.java**
```java
@Transactional
public class UserServiceV3 {

  private final EntityManager em;
  private final UserRepositoryV3 userRepositoryV3;

  public UserServiceV3(EntityManager em) {
    this.em = em;
    this.userRepositoryV3 = new UserRepositoryV3(em);
  }

  public Long join(User user){
    return userRepositoryV3.save(user);
  }

  public User findOne(Long userId){
    Optional<User> findUser=userRepositoryV3.findById(userId);

    return findUser.orElseThrow(()->{
              throw new RuntimeException();
            }
    );
  }
}
```

**UserServiceV3Test.java**
```java
@SpringBootTest
@Transactional
public class UserServiceV3Test {

    @Autowired EntityManager em;

    @Test
    @DisplayName("v3 service test")
    void service_v3_í…ŒìŠ¤íŠ¸(){
        User user=createUser("hong","123");

        UserServiceV3 userServiceV3=new UserServiceV3(em);

        Long joinId = userServiceV3.join(user);

        User findUser = userServiceV3.findOne(joinId);

        Assertions.assertThat(findUser.getName()).isEqualTo(user.getName());
        Assertions.assertThat(findUser.getId()).isEqualTo(joinId);
    }

    private User createUser(String name, String password){
        return User.createUser()
                .name(name)
                .password(password)
                .build();
    }
}
```

**ë™ì‘ í™•ì¸**

<img width="50%" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-09-28 á„‹á…©á„’á…® 7 10 32" src="https://user-images.githubusercontent.com/56334761/135067909-22b78bb8-3a91-4eec-85b4-ef97401543e6.png">

**ë™ì‘ì´ ë˜ëŠ” ê²ƒì„ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

í•˜ì§€ë§Œ, í•œ ëˆˆì— ë³´ë”ë¼ë„ ë§ì€ ë¬¸ì œê°€ ì¡´ì¬í•˜ì£ !
- `repository`ì˜ í™•ì¥ì´ ë‹¤ì‹œ ë¶ˆê°€ëŠ¥í•´ì¡ŒìŠµë‹ˆë‹¤.
  - `service`ì˜ ì½”ë“œê°€ íŠ¹ì • `repository`ì— ì¢…ì†ë˜ì—ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. 
  - ë§Œì¼, `repsitory`ì˜ íŠ¹ì • ë©”ì†Œë“œ ì´ë¦„ì´ ë°”ë€Œê³ , ì´ ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ê³³ì´ ìˆ˜ ë°±ê°œ ì´ìƒì´ë¼ë©´ ì¼ì¼íˆ ë‹¤ ì°¾ì•„ê°€ì„œ ìˆ˜ì •í•˜ëŠ” ì‘ì—…ì€ ë„ˆë¬´ ë²ˆê±°ë¡­ê²Œ ë©ë‹ˆë‹¤.
- `repsotory`ê°€ ì–´ë–¤ í´ë˜ìŠ¤ì¸ì§€ `service`ì—ì„œ êµ¬ì²´ì ìœ¼ë¡œ ì•Œê³  ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ì¦‰, ì´ ë˜í•œ í´ë˜ìŠ¤ì˜ ë³€ê²½ì´ ì¼ì–´ë‚œë‹¤ë©´, ì‚¬ìš©í•˜ê³  ìˆëŠ” í´ë˜ìŠ¤ì—ì„œ ì¼ì¼íˆ ìˆ˜ì •ì„ í•´ì•¼í•©ë‹ˆë‹¤.

**ê²°ë¡ ì ìœ¼ë¡œ, ì´ëŸ° ì‹ìœ¼ë¡œ ì„¤ê³„ê°€ ëœë‹¤ë©´, ì–´ë–¤ í´ë˜ìŠ¤ê°€ ì“°ì¼ì§€ ì–´ë–¤ ë©”ì†Œë“œê°€ ì“°ì¼ì§€ì— ëŒ€í•œ ì •ë³´ë¥¼ ì¼ì¼íˆ ë‹¤ ì•Œê³  ìˆì–´ì•¼ í•©ë‹ˆë‹¤.**
- ë”°ë¼ì„œ `service`ëŠ” êµ¬ì²´ì ì¸ `repository`í´ë˜ìŠ¤ì— ì¢…ì†ë ìˆ˜ ë°–ì— ì—†ìŠµë‹ˆë‹¤.

**ìƒì†ì˜ ë¬¸ì œë¥¼ í•´ê²°í•˜ê³ ì í•œ ê²ƒì´ ë” ë§ì€ ë¬¸ì œë¥¼ ì´ˆë˜í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.**

### ğŸ”§ Version 4.