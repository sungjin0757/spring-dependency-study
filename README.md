## ì˜¤ë¸Œì íŠ¸ì™€ ì˜ì¡´ê´€ê³„ STUDY
***

## ğŸ¯ ëª©ì°¨
#### ğŸ“Œ ìŠ¤í”„ë§ì˜ ì§€í–¥ì 
#### ğŸ“Œ ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬
#### ğŸ“Œ ì œì–´ì˜ ì—­ì „ (IOC)
#### ğŸ“Œ ìŠ¤í”„ë§ IOC
#### ğŸ“Œ ì‹±ê¸€í†¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬
#### ğŸ“Œ ì˜ì¡´ê´€ê³„ ì£¼ì…(DI)
***
## ğŸš€ ìŠ¤í”„ë§ì˜ ì§€í–¥ì 
**ìŠ¤í”„ë§ì€ ìë°”ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ê¸°ìˆ !**
- ìë°”ì—ì„œ ê°€ì¥ ì¤‘ìš”í•˜ê²Œ ê°€ì¹˜ë¥¼ ë‘ëŠ” ê²ƒì€ ê°ì²´ì§€í–¥
  - So, ìŠ¤í”„ë§ì´ ê°€ì¥ ê´€ì‹¬ì„ ë§ì´ ë‘ëŠ” ëŒ€ìƒì€ ì˜¤ë¸Œì íŠ¸ ì…ë‹ˆë‹¤.
  ìŠ¤í”„ë§ì„ ì´í•´í•˜ë ¤ë©´ ë¨¼ì € ì˜¤ë¸Œì íŠ¸ì— ê¹Šì€ ê´€ì‹¬ì„ ê°€ì ¸ì•¼ í•˜ë©°, ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì˜¤ë¸Œì íŠ¸ê°€ ìƒì„±ë˜ê³ 
  ë‹¤ë¥¸ ì˜¤ë¸Œì íŠ¸ì™€ ê´€ê³„ë¥¼ ë§ºê³ , ì‚¬ìš©ë˜ê³ , ì†Œë©¸í•˜ê¸°ê¹Œì§€ì˜ ì „ ê³¼ì •ì„ ì´í•´í•˜ê³  ìˆì–´ì•¼í•©ë‹ˆë‹¤.
  
  - ì˜¤ë¸Œì íŠ¸ì— ëŒ€í•œ ê´€ì‹¬ì€ ì˜¤ë¸Œì íŠ¸ì˜ ì„¤ê³„ì— ëŒ€í•œ ê´€ì‹¬ìœ¼ë¡œ ë°œì „
    - ë‹¤ì–‘í•œ ëª©ì ì„ ìœ„í•´ ì¬í™œìš© ê°€ëŠ¥í•œ ì„¤ê³„ ë°©ë²•ì¸ ë””ìì¸ íŒ¨í„´
    - ì¢€ ë” ê¹”ë”í•œ êµ¬ì¡°ê°€ ë˜ë„ë¡ ì§€ì†ì ìœ¼ë¡œ ê°œì„ í•´ë‚˜ê°€ëŠ” ì‘ì—…ì¸ ë¦¬íŒ©í† ë§
    - í…ŒìŠ¤íŠ¸
    
- ê°ì²´ì§€í–¥ ê¸°ìˆ ê³¼ ì„¤ê³„, êµ¬í˜„ì— ê´€í•œ ì‹¤ìš©ì ì¸ ì „ëµì„ ê°œë°œìë“¤ì´ ìì—°ìŠ¤ëŸ½ê³  ì†ì‰½ê²Œ ì ìš©í•  ìˆ˜ ìˆë„ë¡ í”„ë ˆì„ì›Œí¬ í˜•íƒœë¡œ ì œê³µ
  

***
## ğŸš€ ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬

### ğŸ” í…ŒìŠ¤íŠ¸ ë‚´ìš©

**ì•„ë˜ì˜ 3ê°€ì§€ `repository`, `service`, `domain` ì„ í™œìš©í•˜ì—¬ ì•„ë¬´ ì„¤ì •ë„ ì•ˆë˜ì–´ ìˆëŠ” ë‚œê°í•œ
ìƒíƒœì—ì„œ ì œê°€ í•™ìŠµí•œ ë‚˜ë¦„ëŒ€ë¡œ Ver 1. ë¶€í„° Ver 5. ê¹Œì§€ì˜ ìŠ¤í”„ë§ì´ ì§€í–¥í•˜ëŠ” ìƒíƒœë¡œì˜ ë°œì „ì„ ë³´ì—¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤.**
- ì‚¬ìš©ì ì •ë³´ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•  `repository`
  - í¸ì˜ë¥¼ ìœ„í•´ `JPA`ë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.
- ë„ë©”ì¸ ì •ë³´ë¥¼ í™œìš©í•˜ì—¬ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë‹´ë‹¹í•  `service`
- ìœ ì € ì •ë³´ë¥¼ ë‹´ê³  ìˆëŠ” `domain`

**User.java (ëª¨ë“  Version ì—ì„œ ì‚¬ìš©í•  ë„ë©”ì¸)**
```java
@Getter
@Entity
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class User {

    @Id @GeneratedValue
    @Column(name="user_id")
    private Long id;

    private String name;
    private String password;

    @Builder(builderMethodName = "createUser")
    public User(String name,String password){
        this.name=name;
        this.password=password;
    }

}
```

### ğŸ”§ Version 1. 
- `repository` í´ë˜ìŠ¤ë§Œ ì¡´ì¬

**UserRepositoryV1.java**

```java
import org.springframework.transaction.annotation.Transactional;

@RequiredArgsConstructor
@Transactional
public class UserRepositoryV1 {

  private final EntityManager em;

  public Long join(User user) {
    return save(user);
  }

  public User findOne(Long userId) {
    Optional<User> findUser = findById(userId);

    return findUser.orElseThrow(() -> {
              throw new RuntimeException();
            }
    );
  }

  public Long save(User user) {
    em.persist(user);
    return user.getId();
  }

  public Optional<User> findById(Long id) {
    return Optional.ofNullable(em.find(User.class, id));
  }

  public void remove(Long id) {
    User user = findOne(id);
    em.remove(user);
  }

}


```

**UserRepositoryV1Test.java(ë™ì‘ í™•ì¸)**
```java
@Transactional
@SpringBootTest
public class UserRepositoryV1Test {

  @Autowired
  EntityManager em;

  @Test
  @DisplayName("ë°ì´í„° ì €ì¥ í…ŒìŠ¤íŠ¸")
  void íšŒì›ì €ì¥_Test(){
    User user=User.createUser()
            .name("í™ì„±ì§„")
            .password("1234")
            .build();

    UserRepositoryV1 userRepository=new UserRepositoryV1(em);
    Long saveId = userRepository.save(user);

    User findUser = userRepository.findOne(saveId);

    Assertions.assertThat(findUser.getName()).isEqualTo(user.getName());
    Assertions.assertThat(findUser.getPassword()).isEqualTo(user.getPassword());
  }
}
```

**í…ŒìŠ¤íŠ¸ ê²°ê³¼**

<img width="50%" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-09-27 á„‹á…©á„’á…® 9 04 08" src="https://user-images.githubusercontent.com/56334761/134904927-cd84d2d8-0e8a-40c1-9a1f-4c0c8b3b089f.png">

**ì´ëŸ° ì‹ìœ¼ë¡œ `repository` í´ë˜ìŠ¤ë§Œ ë”± ì“°ëŠ” ê²ƒì€ ê°ì²´ì§€í–¥ê´€ì ì—ì„œ êµ‰ì¥í•œ ë¬¸ì œë¥¼ ì´ˆë˜í•œë‹¤ê³  í•©ë‹ˆë‹¤.**
- ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ” ê²ƒì´ í™•ì¸ ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¼ë° ë¬¸ì œê°€??!
- ë¬¸ì œë¥¼ ê°œì„ í–ˆì„ ë•Œì˜ ì¥ì ì€?
- ë¯¸ë˜ì— ì£¼ëŠ” ìœ ìµ?!

**ì´ëŸ¬í•œ ê³ ì°°(ì¢‹ì€ ê°ì²´ì§€í–¥ ì„¤ê³„)ì´ ìŠ¤í”„ë§ì„ í™œìš©í•œ ê°œë°œì˜ ì²« ê±¸ìŒì´ ë˜ì—ˆë‹¤ê³  í•©ë‹ˆë‹¤.**

- **ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬**
  - ê°ì²´ì§€í–¥ì˜ ì„¸ê³„ëŠ” ëª¨ë“  ê²ƒ(ì˜¤ë¸Œì íŠ¸ì— ëŒ€í•œ ì„¤ê³„ì™€ ì´ë¥¼ êµ¬í˜„í•œ ì½”ë“œ)ì´ ë³€í•¨.
    - ì‚¬ìš©ìì˜ ìš”êµ¬ì‚¬í•­ì— ë”°ë¼
    - ì‹œê°„ì´ ë³€í•¨ì— ë”°ë¼
    - ...
  - **So,** ê°œë°œìê°€ ê°ì²´ë¥¼ ì„¤ê³„í•  ë•Œ ê°€ì¥ ì—¼ë‘í•´ì•¼í•  ì‚¬í•­ì€ ë°”ë¡œ ë¯¸ë˜ì˜ ë³€í™”ë¥¼ ì–´ë–»ê²Œ ëŒ€ì²˜í•  ê²ƒì¸ê°€? ì…ë‹ˆë‹¤.
    - **ex)** ê¸°ëŠ¥ ë³€í™”ì— ëŒ€í•œ ìš”êµ¬ì‚¬í•­ì„ ë¯¸ë˜ë¥¼ ì˜ ëŒ€ë¹„í•œ ê°œë°œìëŠ” ë‹¨ì§€ ëª‡ ì¤„ì˜ ì½”ë“œ ìˆ˜ì • ë° ê²€ì¦ ê¹Œì§€ì˜ ì‹œê°„ì´ 5ë¶„ì´ì—ˆë‹¤ë©´,
    ë¯¸ë˜ë¥¼ ëŒ€ë¹„í•˜ì§€ ì•Šì€ ê°œë°œìëŠ” 5ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.
  - ê°ì²´ ì§€í–¥ ê¸°ìˆ ì€ ì¶”ìƒì„¸ê³„ë¥¼ ììœ ë¡­ê²Œ ë³€ê²½, í™•ì¥ì‹œí‚¬ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì— ì˜ë¯¸ê°€ ìˆìŠµë‹ˆë‹¤.
  - ë¶„ë¦¬ì™€ í™•ì¥ì„ ê³ ë ¤í•œ ì„¤ê³„ë¥¼ í•˜ë©´ í•„ìš”í•œ ì‘ì—…ì„ ìµœì†Œí™”í•˜ê³ , ë³€ê²½ì´ ë‹¤ë¥¸ ì‘ì—…ì— ë¬¸ì œë¥¼ ì¼ìœ¼í‚¤ì§€ ì•Šì„ ê²ƒì…ë‹ˆë‹¤.

- **ë¶„ë¦¬**
  - ëª¨ë“  ë³€ê²½ê³¼ ë°œì „ì€ í•œ ë²ˆì— í•œ ê°€ì§€ ê´€ì‹¬ì‚¬í•­ì— ì§‘ì¤‘í•´ì„œ ì¼ì–´ë‚©ë‹ˆë‹¤.
    - **ex)** DBì˜ ì ‘ì†ìš© ì•”í˜¸ë¥¼ ë³€ê²½í•˜ë¼
    - ì—¬ê¸°ì„œ ì¼ì–´ë‚˜ëŠ” ë¬¸ì œëŠ” ë³€í™”ì— ë”°ë¥¸ ì‘ì—…ì€ í•œ ê³³ì— ì§‘ì¤‘ë˜ì§€ ì•Šë‹¤ëŠ” ê²½ìš°ê°€ ë§ë“œëŠ” ê²ƒì…ë‹ˆë‹¤. ì¦‰, DB ì ‘ì† ì•”í˜¸ë¥¼ ë³€ê²½í•˜ê¸°ìœ„í•´ ìˆ˜ ë°±ê°œì˜ í´ë˜ìŠ¤ë¥¼
    ëŒì•„ë‹¤ë‹ˆë©°, í™•ì¸ì„ í•´ì•¼í•  ìˆ˜ë„ ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.
  - **So, ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´?** ê³µí†µ ê´€ì‹¬ì‚¬í•­ì„ ê°€ì§„ ê²ƒë“¤ì„ í•œ ê³³ì— ì§‘ì¤‘ì‹œí‚¤ë©´ ë©ë‹ˆë‹¤.
  - ê´€ì‹¬ì´ ê°™ì€ ê²ƒë¼ë¦¬ëŠ” í•˜ë‚˜ì˜ ê°ì²´ ì•ˆìœ¼ë¡œ , ë‹¤ë¥¸ ê²ƒì€ ë”°ë¡œ ë–¨ì–´ì ¸ ì„œë¡œ ì˜í–¥ì„ ë¼ì¹˜ì§€ ì•Šë„ë¡ í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
  
  - **ë¶„ë¦¬ì˜ ì˜ˆ**
    - ì¤‘ë³µ ì½”ë“œì˜ ë©”ì†Œë“œ ì¶”ì¶œ (ë¦¬íŒ©í† ë§ì˜ ë©”ì†Œë“œ ì¶”ì¶œ ê¸°ë²•)
      - ì´ì  : ë§Œì¼ ì¤‘ë³µ ì½”ë“œê°€ ìˆ˜ ì²œê°œì˜ ë©”ì†Œë“œì— í©ì–´ì ¸ ìˆë‹¤ê³  ìƒê°í•©ì‹œë‹¤. ê·¼ë°, ì¤‘ë³µ ì½”ë“œì— ëŒ€í•œ ë³€ê²½ì´ í•„ìš”í•˜ë‹¤ë©´?? ìˆ˜ ì²œê°œì˜ ë©”ì†Œë“œë¥¼
      ì¼ì¼íˆ ìˆ˜ì •í•˜ê³  ìˆì–´ì•¼í•  ê²ƒì…ë‹ˆë‹¤. ë§Œì¼ ì¤‘ë³µ ì½”ë“œë¥¼ ë©”ì†Œë“œë¡œ ì¶”ì¶œí•˜ì—¬ë†¨ìœ¼ë©´, ë”± í•œ ê³³ë§Œ ë°”ê¾¸ê¸°ë§Œ í•˜ë©´ ë˜ì£ ..
    

**ë§Œì•½, `repository`ì˜ ë¡œì§ì„ ìƒí™©ì— ë”°ë¼ ë°”ê¾¸ê³  ì‹¶ë‹¤ê³  ê°€ì •í•´ ë´…ì‹œë‹¤.**

í•˜ì§€ë§Œ, í˜„ì¬, Ver 1. ì—ì„œëŠ” `repository`í´ë˜ìŠ¤ í•˜ë‚˜ë¡œë§Œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì¦‰, ì‚¬ìš© ì‹œì ë§ˆë‹¤ ì›í•˜ëŠ” ë¡œì§ì— ëŒ€í•œ ì½”ë“œë¡œì˜ ë²ˆê±°ë¡œìš´ ìˆ˜ì •ì´
í•„ìš”í•˜ê²Œ ë©ë‹ˆë‹¤. ë˜í•œ, ì´ í´ë˜ìŠ¤ë¥¼ ê°œë°œí•œ ê°œë°œìê°€ ê·¸ë§Œë‘ê³  ë‹¤ë¥¸ ê°œë°œìê°€ ì´ì–´ì„œ ì‘ì—…ì„ í•œë‹¤ê³  ìƒê°í•œë‹¤ë©´, ì–´ëŠ ë¶€ë¶„ì„ ìˆ˜ì •í•´ì•¼ í•  ì§€ë„
ëª¨ë¥¼ ìˆ˜ ìˆìœ¼ë©° ê´€ì‹¬ì‚¬ê°€ ë‹¤ë¥¸ ë©”ì†Œë“œë“¤ì´ í•œ í´ë˜ìŠ¤ë‚´ì— ë‹¤ ì¡´ì¬í•˜ê³  ìˆìŠµë‹ˆë‹¤.

**ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°ì„ í•˜ê¸° ìœ„í•´ì„œ ê¸°ì¡´ ì½”ë“œë¥¼ ë¶„ë¦¬í•  ì‹œì ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤.**

### ğŸ”§ Version 2.
Version 1. ì—ì„œì˜ ì½”ë“œë¥¼ ë³´ì‹œë©´ í•œ ê°€ì§€ í´ë˜ìŠ¤ë‚´ì— ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•˜ëŠ” ë©”ì†Œë“œì™€ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì´ìš©í•˜ì—¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë‹´ë‹¹í•˜ê³  ìˆëŠ” ë©”ì†Œë“œê°€ ìˆìŠµë‹ˆë‹¤.
ì´ ë‘˜ì˜ ê´€ì‹¬ì‚¬ë¥¼ `repository` ì™€ `service`ë¡œ ë¶„ë¦¬ì‹œì¼œ ë´…ì‹œë‹¤.
ì–´ë–»ê²Œ í• ê¹Œìš”??!
- ìƒì†ì„ í†µí•œ í™•ì¥
 
**UserRepositoryV2.java**

```java
public abstract class UserServiceV2 {

  public Long join(User user){
    return save(user);
  }

  public User findOne(Long userId){
    Optional<User> findUser=findById(userId);

    return findUser.orElseThrow(()->{
              throw new RuntimeException();
            }
    );
  }
  public abstract Long save(User user);
  public abstract Optional<User> findById(Long userId);
  public abstract void remove(Long userId);
}

```

**UserRepositoryV2Extends.java**

```java
@RequiredArgsConstructor
public class UserRepositoryV2Extends extends UserServiceV2{

    private final EntityManager em;

    @Override
    public Long save(User user) {
        em.persist(user);
        return user.getId();
    }

    @Override
    public Optional<User> findById(Long userId) {
        return Optional.ofNullable(em.find(User.class,userId));
    }

    @Override
    public void remove(Long userId) {
        User findUser = findById(userId).orElse(null);

        if(findUser==null)
            throw  new IllegalArgumentException();

        em.remove(findUser);
    }
}
```

**UserServiceV2Test.java**

```java
@SpringBootTest
@Transactional
public class UserServiceV2Test {

  @Autowired
  EntityManager em;

  @Test
  @DisplayName("V2 test")
  void V2_í…ŒìŠ¤íŠ¸(){

    User user=createUser("hong","1234");

    UserServiceV2 userService=new UserRepositoryV2Extends(em);

    Long saveId = userService.join(user);

    User findUser = userService.findOne(saveId).get();

    Assertions.assertThat(findUser.getName()).isEqualTo(user.getName());
    Assertions.assertThat(findUser.getPassword()).isEqualTo(user.getPassword());
  }

  private User createUser(String name, String password){
    return User.createUser()
            .name(name)
            .password(password)
            .build();
  }
}
```

**í…ŒìŠ¤íŠ¸ ê²°ê³¼**

<img width="50%" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-09-28 á„‹á…©á„’á…® 5 33 37" src="https://user-images.githubusercontent.com/56334761/135062980-7c4e4236-43ad-48e1-8ff4-e6e0d792cba9.png">

**ì¶”ìƒ í´ë˜ìŠ¤ë¥¼ í™œìš©í•˜ì—¬ `repository`ì˜ ë³€ê²½ ì‘ì—…ì„ í•œì¸µ ë” ìš©ì´í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.**
- ë‹¨ìˆœíˆ ë³€ê²½ ì´ìƒìœ¼ë¡œ ì†ì‰½ê²Œ í™•ì¥í•  ìˆ˜ ë„ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.
- ì´ì œëŠ” `repository`í´ë˜ìŠ¤ì˜ ì½”ë“œë¥¼ ë³€ê²½í•  í•„ìš”ì—†ì´ ê¸°ëŠ¥ì„ ìƒˆë¡­ê²Œ ì •ì˜í•œ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ğŸ‘ í…œí”Œë¦¿ ë©”ì†Œë“œ íŒ¨í„´**
>ê¸°ë³¸ì ì¸ ë¡œì§ì˜ íë¦„ì„ ë§Œë“¤ê³ , ê·¸ ê¸°ëŠ¥ì˜ ì¼ë¶€ë¥¼ ì¶”ìƒ ë©”ì†Œë“œë‚˜ ì˜¤ë²„ë¼ì´ë”©ì´ ê°€ëŠ¥í•œ ë©”ì†Œë“œ ë“±ìœ¼ë¡œ ë§Œë“  ë’¤
ì„œë¸Œí´ë˜ìŠ¤ì—ì„œ ì´ëŸ° ë©”ì†Œë“œë¥¼ í•„ìš”ì— ë§ê²Œ êµ¬í˜„í•´ì„œ ì‚¬ìš©í•˜ë„ë¡ í•˜ëŠ” ë°©ë²•ì„ ë””ìì¸ íŒ¨í„´ì—ì„œ í…œí”Œë¦¿ ë©”ì†Œë“œ íŒ¨í„´ì´ë¼ê³  í•©ë‹ˆë‹¤.

**BUT, ë³€ê²½ ë° í™•ì¥ì´ ìš©ì´í•´ì¡Œì§€ë§Œ ìƒì†ì„ í™œìš©í–ˆë‹¤ëŠ” ë‹¨ì ì´ ì¡´ì¬**
- ìë°”ëŠ” ë‹¤ì¤‘ìƒì† í—ˆìš© ê¸ˆì§€.
- ì„œë¸Œ í´ë˜ìŠ¤ê°€ ìŠˆí¼ í´ë˜ìŠ¤ì˜ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ.
  - ìŠˆí¼ í´ë˜ìŠ¤ ë‚´ë¶€ì˜ ë³€ê²½ì´ ìˆì„ ë•Œ, ëª¨ë“  ì„œë¸Œí´ë˜ìŠ¤ì˜ ë‚´ìš©ì„ ìˆ˜ì •í•´ì•¼í•  ìˆ˜ë„ ìˆìŒ. ì¦‰, ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬ê°€ ì™„ë²½í•˜ì§€ ì•Šë‹¤ëŠ” ëœ».

### ğŸ”§ Version 3.
- ë…ë¦½ì ì¸ í´ë˜ìŠ¤ë¡œ ë¶„ë¦¬í•˜ì—¬ ê´€ì‹¬ì‚¬ë¥¼ ë¶„ë¦¬
  - `repository` ê´€ë ¨ëœ ë¶€ë¶„ì„ ìƒì†í´ë˜ìŠ¤ê°€ ì•„ë‹Œ ì•„ì˜ˆ ë³„ë„ì˜ í´ë˜ìŠ¤ë¡œ ë§Œë“¤ì–´ë´…ì‹œë‹¤.

**UserRepositoryV3.java**
```java
@RequiredArgsConstructor
public class UserRepositoryV3 {

    private final EntityManager em;

    public Long save(User user){
        em.persist(user);
        return user.getId();
    }

    public void remove(Long id){
        User findUser = findById(id).orElse(null);
        if(findUser==null)
            throw  new IllegalArgumentException();
        em.remove(findUser);
    }
    public Optional<User> findById(Long id){
        return Optional.ofNullable(em.find(User.class,id));
    }
    public Optional<User> findByName(String name){
        return Optional.ofNullable(em.createQuery("select u from User u where u.name=:name",User.class)
                .setParameter("name",name)
                .getSingleResult());
    }

}
```

**UserServiceV3.java**
```java
@Transactional
public class UserServiceV3 {

  private final EntityManager em;
  private final UserRepositoryV3 userRepositoryV3;

  public UserServiceV3(EntityManager em) {
    this.em = em;
    this.userRepositoryV3 = new UserRepositoryV3(em);
  }

  public Long join(User user){
    return userRepositoryV3.save(user);
  }

  public User findOne(Long userId){
    Optional<User> findUser=userRepositoryV3.findById(userId);

    return findUser.orElseThrow(()->{
              throw new RuntimeException();
            }
    );
  }
}
```

**UserServiceV3Test.java**
```java
@SpringBootTest
@Transactional
public class UserServiceV3Test {

    @Autowired EntityManager em;

    @Test
    @DisplayName("v3 service test")
    void service_v3_í…ŒìŠ¤íŠ¸(){
        User user=createUser("hong","123");

        UserServiceV3 userServiceV3=new UserServiceV3(em);

        Long joinId = userServiceV3.join(user);

        User findUser = userServiceV3.findOne(joinId);

        Assertions.assertThat(findUser.getName()).isEqualTo(user.getName());
        Assertions.assertThat(findUser.getId()).isEqualTo(joinId);
    }

    private User createUser(String name, String password){
        return User.createUser()
                .name(name)
                .password(password)
                .build();
    }
}
```

**ë™ì‘ í™•ì¸**

<img width="50%" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-09-28 á„‹á…©á„’á…® 7 10 32" src="https://user-images.githubusercontent.com/56334761/135067909-22b78bb8-3a91-4eec-85b4-ef97401543e6.png">

**ë™ì‘ì´ ë˜ëŠ” ê²ƒì„ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

í•˜ì§€ë§Œ, í•œ ëˆˆì— ë³´ë”ë¼ë„ ë§ì€ ë¬¸ì œê°€ ì¡´ì¬í•˜ì£ !
- `repository`ì˜ í™•ì¥ì´ ë‹¤ì‹œ ë¶ˆê°€ëŠ¥í•´ì¡ŒìŠµë‹ˆë‹¤.
  - `service`ì˜ ì½”ë“œê°€ íŠ¹ì • `repository`ì— ì¢…ì†ë˜ì—ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. 
  - ë§Œì¼, `repsitory`ì˜ íŠ¹ì • ë©”ì†Œë“œ ì´ë¦„ì´ ë°”ë€Œê³ , ì´ ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ê³³ì´ ìˆ˜ ë°±ê°œ ì´ìƒì´ë¼ë©´ ì¼ì¼íˆ ë‹¤ ì°¾ì•„ê°€ì„œ ìˆ˜ì •í•˜ëŠ” ì‘ì—…ì€ ë„ˆë¬´ ë²ˆê±°ë¡­ê²Œ ë©ë‹ˆë‹¤.
- `repsotory`ê°€ ì–´ë–¤ í´ë˜ìŠ¤ì¸ì§€ `service`ì—ì„œ êµ¬ì²´ì ìœ¼ë¡œ ì•Œê³  ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ì¦‰, ì´ ë˜í•œ í´ë˜ìŠ¤ì˜ ë³€ê²½ì´ ì¼ì–´ë‚œë‹¤ë©´, ì‚¬ìš©í•˜ê³  ìˆëŠ” í´ë˜ìŠ¤ì—ì„œ ì¼ì¼íˆ ìˆ˜ì •ì„ í•´ì•¼í•©ë‹ˆë‹¤.

**ê²°ë¡ ì ìœ¼ë¡œ, ì´ëŸ° ì‹ìœ¼ë¡œ ì„¤ê³„ê°€ ëœë‹¤ë©´, ì–´ë–¤ í´ë˜ìŠ¤ê°€ ì“°ì¼ì§€ ì–´ë–¤ ë©”ì†Œë“œê°€ ì“°ì¼ì§€ì— ëŒ€í•œ ì •ë³´ë¥¼ ì¼ì¼íˆ ë‹¤ ì•Œê³  ìˆì–´ì•¼ í•©ë‹ˆë‹¤.**
- ë”°ë¼ì„œ `service`ëŠ” êµ¬ì²´ì ì¸ `repository`í´ë˜ìŠ¤ì— ì¢…ì†ë ìˆ˜ ë°–ì— ì—†ìŠµë‹ˆë‹¤.

**ìƒì†ì˜ ë¬¸ì œë¥¼ í•´ê²°í•˜ê³ ì í•œ ê²ƒì´ ë” ë§ì€ ë¬¸ì œë¥¼ ì´ˆë˜í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.**

### ğŸ”§ Version 4.
- ì¸í„°í˜ì´ìŠ¤ì˜ ë„ì…
  - ë‘ ê°œì˜ í´ë˜ìŠ¤ê°€ ì„œë¡œ ê¸´ë°€í•˜ê²Œ ì—°ê²°ë˜ì–´ ìˆì§€ ì•Šë„ë¡ 
  - ìë°”ê°€ ì¶”ìƒí™”ë¥¼ ìœ„í•´ ì œê³µí•˜ëŠ” ê°€ì¥ ìœ ìš©í•œ ë„êµ¬
  - ì˜¤ë¸Œì íŠ¸ë¥¼ ë§Œë“œë ¤ë©´ êµ¬ì²´ì ì¸ í´ë˜ìŠ¤ í•˜ë‚˜ë¥¼ ì„ íƒí•´ì•¼ê² ì§€ë§Œ ì ‘ê·¼í•˜ëŠ” ìª½ì—ì„œëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ ë§Œë“¤ ë•Œ ì‚¬ìš©í•  í´ë˜ìŠ¤ê°€ ë¬´ì—‡ì¸ì§€ ëª°ë¼ë„ ë¨.
  - ì¸í„°í˜ì´ìŠ¤ëŠ” ì–´ë–¤ ì¼ì„ í•˜ê² ë‹¤ëŠ” ê¸°ëŠ¥ë§Œ ì •ì˜í•´ë†“ì€ ê²ƒì…ë‹ˆë‹¤.

**UserRepositoryV4.java**
```java
public interface UserRepositoryV4 {

    Long save(User user);
    Optional<User> findById(Long userId);
    void remove(Long userId);
}

```

**UserRepositoryV4Impl.java**
```java
@RequiredArgsConstructor
public class UserRepositoryV4Impl implements UserRepositoryV4{

    private final EntityManager em;

    @Override
    public Long save(User user) {
        em.persist(user);
        return user.getId();
    }

    @Override
    public Optional<User> findById(Long userId) {
        return Optional.ofNullable(em.find(User.class,userId));
    }

    @Override
    public void remove(Long userId) {
        User findUser = findById(userId).orElse(null);
        if(findUser==null)
            throw  new IllegalArgumentException();
        em.remove(findUser);
    }
}

```

**UserServiceV4.java**
```java
@Transactional
public class UserServiceV4 {

    private final UserRepositoryV4 userRepositoryV4;

    public UserServiceV4(EntityManager em) {
        this.userRepositoryV4 = new UserRepositoryV4Impl(em);
    }

    public Long join(User user){
        return userRepositoryV4.save(user);
    }

    public User findOne(Long userId){
        Optional<User> findUser=userRepositoryV4.findById(userId);

        return findUser.orElseThrow(()->{
                    throw new RuntimeException();
                }
        );
    }
}
```

**UserServiceV4Test.java**
```java
@SpringBootTest
@Transactional
public class UserServiceV4Test {

    @Autowired EntityManager em;

    @Test
    @DisplayName("V4 service test")
    void v4_ì„œë¹„ìŠ¤_í…ŒìŠ¤íŠ¸(){
        User user=createUser("hong","123");

        UserServiceV4 userServiceV4=new UserServiceV4(em);
        Long saveId = userServiceV4.join(user);

        User findUser = userServiceV4.findOne(saveId);

        Assertions.assertThat(findUser.getName()).isEqualTo(user.getName());
        Assertions.assertThat(findUser.getPassword()).isEqualTo(user.getPassword());
    }

    private User createUser(String name, String password){
        return User.createUser()
                .name(name)
                .password(password)
                .build();
    }
}
```

**ë™ì‘í™•ì¸**

<img width="50%" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-10-01 á„‹á…©á„Œá…¥á†« 1 59 15" src="https://user-images.githubusercontent.com/56334761/135499077-0f396bb8-d51f-4951-8af4-15c64e7abcfe.png">

**ë¬¸ì œì **

**`userServiceV4` í´ë˜ìŠ¤ë¥¼ ë³´ì‹œë©´ ì—¬ì „íˆ êµ¬ì²´ì ì¸ í´ë˜ìŠ¤ì— ì¢…ì†ë˜ê³  ìˆë‹¤ëŠ” ê²ƒì„ ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤!**
```java
public UserServiceV4(EntityManager em) {
        this.userRepositoryV4 = new UserRepositoryV4Impl(em);
    }
```
í .. ê·¸ë ‡ë‹¤ë©´ í´ë˜ìŠ¤ ì´ë¦„ì„ ë„£ì–´ì„œ ì˜¤ë¸Œì íŠ¸ë¥¼ ë§Œë“¤ì§€ ì•Šìœ¼ë©´ ì–´ë–»ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆì„ê¹Œìš”..

### ğŸ”§ Version 5.

ë¨¼ì € Ver 4. ì—ì„œì˜ ë¬¸ì œë¥¼ ë³´ë©´ `userService` ì™€ `userService`ê°€ ì‚¬ìš©í•  `userRepository`
ì˜ íŠ¹ì • êµ¬í˜„ í´ë˜ìŠ¤ ì‚¬ì´ì˜ ê´€ê³„ë¥¼ ì„¤ì •í•´ì£¼ëŠ” ê²ƒì— ëŒ€í•œ ê´€ì‹¬ì´ ì”ì¡´í•˜ê³  ìˆë‹¤ëŠ” ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤.

ì´ ê´€ì‹¬ì‚¬ë¥¼ ë‹´ì€ ì½”ë“œë¥¼ ë¶„ë¦¬í•˜ì§€ ì•Šìœ¼ë©´ ë…ë¦½ì ìœ¼ë¡œ í™•ì¥ ê°€ëŠ¥í•œ í´ë˜ìŠ¤ê°€ ë  ìˆ˜ ì—†ì„ ê²ƒì…ë‹ˆë‹¤.

**í•´ê²° ë°©ë²•**
- í´ë¼ì´ì–¸íŠ¸ ì˜¤ë¸Œì íŠ¸ì˜ í™œìš©
  - ë‘ ê°œì˜ ì˜¤ë¸Œì íŠ¸ê°€ ìˆê³ , í•œ ì˜¤ë¸Œì íŠ¸ê°€ ë‹¤ë¥¸ ì˜¤ë¸Œì íŠ¸ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ ì‚¬ìš©í•˜ëŠ” ìª½ì„ í´ë¼ì´ì–¸íŠ¸ ì˜¤ë¸Œì íŠ¸, ì‚¬ìš©ë˜ëŠ” ìª½ì„ ì˜¤ë¸Œì íŠ¸ ì„œë¹„ìŠ¤ë¼ê³  í•©ë‹ˆë‹¤.
  - ğŸ‘ ì´ë¥¼ í™œìš©í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ ì˜¤ë¸Œì íŠ¸ì—ì„œ `service` ì™€ `repository`ì˜ ê´€ê³„ë¥¼ ê²°ì •í•´ì£¼ëŠ” ê¸°ëŠ¥ì„ ë¶„ë¦¬í•´ ë‘ë©´ ë©ë‹ˆë”.

**ìì„¸íˆ**
- í´ë˜ìŠ¤ ì‚¬ì´ì— ê´€ê³„ê°€ ë§Œë“¤ì–´ì§„ë‹¤ëŠ” ê²ƒì€ í•œ í´ë˜ìŠ¤ê°€ ì¸í„°í˜ì´ìŠ¤ ì—†ì´ ë‹¤ë¥¸ í´ë˜ìŠ¤ë¥¼ ì§ì ‘ ì‚¬ìš©í•œë‹¤ëŠ” ëœ».
- ë”°ë¼ì„œ í´ë˜ìŠ¤ê°€ ì•„ë‹ˆë¼ ì˜¤ë¸Œì íŠ¸ì™€ ì˜¤ë¸Œì íŠ¸ ì‚¬ì´ì˜ ê´€ê³„ë¥¼ ì„¤ì •í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.
  - ì˜¤ë¸Œì íŠ¸ ì‚¬ì´ì˜ ê´€ê³„ëŠ” ëŸ°íƒ€ì„ ì‹œì— í•œìª½ì´ ë‹¤ë¥¸ ì˜¤ë¸Œì íŠ¸ì˜ ë ˆí¼ëŸ°ìŠ¤ë¥¼ ê°–ê³  ìˆëŠ” ë°©ì‹ìœ¼ë¡œ ë§Œë“¤ì–´ ì§‘ë‹ˆë‹¤.
- `service` ì˜¤ë¸Œì íŠ¸ê°€ `repository` ì¸í„°í˜ì´ìŠ¤ì™€ ê´€ê³„ë¥¼ ë§ºìœ¼ë ¤ë©´ ì¸í„°í˜ì´ìŠ¤ë¥´ êµ¬í˜„í•œ ì˜¤ë¸Œì íŠ¸ê°€ ìˆì–´ì•¼ í• í…ë°, ì´ë¥¼ êµ³ì´ `service`ì˜¤ë¸Œì íŠ¸ì—ì„œ í•´ì£¼ëŠ” 
ê²ƒì´ ì•„ë‹ˆë¼ê³  ì´í•´í•˜ë©´ ë˜ê² ìŠµë‹ˆë‹¤. 
  - ì¦‰, í´ë¼ì´ì–¸íŠ¸ ì˜¤ë¸Œì íŠ¸ì—ì„œ ë©”ì†Œë“œ íŒŒë¼ë¯¸í„° ë“±ì„ í†µí•´ì„œ êµ¬í˜„ëœ ì˜¤ë¸Œì íŠ¸ë¥¼ ì œê³µí•´ì£¼ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.
  - ë˜í•œ ì˜¤ë¸Œì íŠ¸ë¥¼ ì œê³µë°›ëŠ” ìª½ì€ ìƒì„±ì, ìˆ˜ì •ì, ì¼ë°˜ ë©”ì†Œë“œë“±ì„ í†µí•´ì„œ ì „ë‹¬ ë°›ìœ¼ë©´ ë©ë‹ˆë‹¤.
  - **ìë°”ì˜ ë‹¤í˜•ì„±**ì´ë¼ëŠ” íŠ¹ì§•ì„ ì˜ í™œìš©í•˜ì—¬ ì˜¤ë¸Œì íŠ¸ë¥¼ ì „ë‹¬ ë°›ëŠ” ì˜¤ë¸Œì íŠ¸ì—ì„œì˜ ìƒì„±ìì˜ íŒŒë¼ë¯¸í„°ëŠ” ì¸í„°í˜ì´ìŠ¤ ìì²´ë¥¼ ì œê³µ ë°›ìœ¼ë©´ ë˜ê³ ,
  ì œê³µí•˜ëŠ” ìª½ì—ì„œ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ ì˜¤ë¸Œì íŠ¸ë¥¼ ì œê³µí•´ì£¼ë©´ë©ë‹ˆë‹¤.

**ìœ„ì˜ íŠ¹ì§•ë“¤ì„ ì´ìš©í•˜ì—¬ ì´ì œëŠ” ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬ê°€ ì™„ë²½í•´ ì¡Œìœ¼ë©°, ì§„ì •ìœ¼ë¡œ ë³€ê²½ê³¼ í™•ì¥ì´ ìš©ì´í•´ì¡ŒìŠµë‹ˆë‹¤.**
- êµ¬ì²´ì ì¸ ì˜¤ë¸Œì íŠ¸ì— ì˜ì¡´ë„ í•˜ì§€ ì•Šê³ ,
- ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì— ì œê³µë°›ì€ ì˜¤ë¸Œì íŠ¸ëŠ” ì •ì˜ëœ ë©”ì†Œë“œë§Œ ì´ìš©í•˜ë©´ ë˜ê¸° ë•Œë¬¸ì— ì œê³µë°›ì€ ì˜¤ë¸Œì íŠ¸ê°€ ì–´ë–¤ í´ë˜ìŠ¤ë¡œ ë¶€í„° ë§Œë“¤ì–´ì¡ŒëŠ”ì§€ë„ ì‹ ê²½ ì•ˆì¨ë„ ë©ë‹ˆë‹¤.

**Code**

**UserRepositoryV5.java**
```java
public interface UserRepositoryV5 {

    Long save(User user);
    Optional<User> findById(Long userId);
    void remove(Long userId);
}

```

**UserRepositoryV5Impl.java**
```java
@RequiredArgsConstructor
public class UserRepositoryV5Impl implements UserRepositoryV5 {

    private final EntityManager em;

    @Override
    public Long save(User user) {
        em.persist(user);
        return user.getId();
    }

    @Override
    public Optional<User> findById(Long userId) {
        return Optional.ofNullable(em.find(User.class,userId));
    }

    @Override
    public void remove(Long userId) {
        User findUser = findById(userId).orElse(null);
        if(findUser==null)
            throw  new IllegalArgumentException();
        em.remove(findUser);
    }

}
```

**UserServiceV5.java**
```java
@Transactional
public class UserServiceV5 {

    private final UserRepositoryV5 userRepositoryV5;

    public UserServiceV5(UserRepositoryV5 userRepositoryV5) {
        this.userRepositoryV5 = userRepositoryV5;
    }

    public Long join(User user){
        return userRepositoryV5.save(user);
    }

    public User findOne(Long userId){
        Optional<User> findUser=userRepositoryV5.findById(userId);

        return findUser.orElseThrow(()->{
                    throw new RuntimeException();
                }
        );
    }
}
```

**AppConfig.java**
```java
@RequiredArgsConstructor
public class AppConfig {

    private final EntityManager em;

    public UserRepositoryV5 userRepository(){
        return new UserRepositoryV5Impl(em);
    }

    public UserServiceV5 userService(){
        return new UserServiceV5(userRepository());
    }
}
```
`AppConfig`ë¥¼ í´ë¼ì´ì–¸íŠ¸ ì˜¤ë¸Œì íŠ¸ë¼ê³  ìƒê°í•˜ì‹œë©´ ë©ë‹ˆë‹¤.
`service` í´ë˜ìŠ¤ì˜ ìƒì„±ìë¥¼ ë³´ì‹œë©´
```java
public UserServiceV5(UserRepositoryV5 userRepositoryV5) {
        this.userRepositoryV5 = userRepositoryV5;
    }
```
êµ¬ì²´ì ì¸ ì˜¤ë¸Œì íŠ¸ì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ” ê²ƒì„ ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**Test**
```java
@SpringBootTest
@Transactional
public class V5Test {

    @PersistenceContext EntityManager em;

    @Test
    @DisplayName("v5 repositoryTest")
    void v5_repository_í…ŒìŠ¤íŠ¸(){
        User user=createUser("hong","1234");

        UserRepositoryV5 userRepository=new UserRepositoryV5Impl(em);

        Long saveId= userRepository.save(user);

        User findUser=userRepository.findById(saveId).get();

        Assertions.assertThat(findUser.getName()).isEqualTo(user.getName());
        Assertions.assertThat(findUser.getPassword()).isEqualTo(user.getPassword());

    }

    @Test
    @DisplayName("v5 total test")
    void v5_í†µí•©_í…ŒìŠ¤íŠ¸(){
        User user=createUser("hong","123");

        AppConfig appConfig=new AppConfig(em);
        UserServiceV5 userService= appConfig.userService();

        Long saveId = userService.join(user);

        User findUser = userService.findOne(saveId);

        Assertions.assertThat(findUser.getName()).isEqualTo(user.getName());
        Assertions.assertThat(findUser.getPassword()).isEqualTo(user.getPassword());
    }



    private User createUser(String name, String password){
        return User.createUser()
                .name(name)
                .password(password)
                .build();
    }
}
```

**ë™ì‘ í™•ì¸**

<img width="50%" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-10-01 á„‹á…©á„Œá…¥á†« 2 46 10" src="https://user-images.githubusercontent.com/56334761/135505200-cdf00341-5d64-4d37-abd0-d1276758948b.png">

**Ver 1. ì—ì„œ Ver 5. ì— ê±¸ì³ ì„œë¡œ ì˜í–¥ì„ ì£¼ì§€ ì•Šìœ¼ë©´ì„œë„ í•„ìš”ì— ë”°ë¼ ììœ ë¡­ê²Œ í™•ì¥í•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ë¥¼ ì™„ì„± í–ˆìŠµë‹ˆë‹¤!!!**

### ğŸ” ì›ì¹™ê³¼ íŒ¨í„´
ì½”ë“œë¥¼ ê°œì„ í•´ì˜¨ ê²°ê³¼ë¥¼ ê°ì²´ì§€í–¥ ê¸°ìˆ ì˜ ì—¬ëŸ¬ ê°€ì§€ ì´ë¡ ì„ í†µí•´ ì•Œì•„ë´…ì‹œë‹¤.

**ê°œë°© íì‡„ ì›ì¹™ (OCP, Open-Closed Principle)**
- 'í´ë˜ìŠ¤ë‚˜ ëª¨ë“ˆì€ í™•ì¥ì—ëŠ” ì—´ë ¤ ìˆì–´ì•¼ í•˜ê³  ë³€ê²½ì—ëŠ” ë‹«í˜€ ìˆì–´ì•¼ í•œë‹¤.'
  - `service`ì—ì„œ `repository`ì˜ ê¸°ëŠ¥ì€ ì–¸ì œë“ ì§€ í™•ì¥ì´ ê°€ëŠ¥í•œ ìƒíƒœì…ë‹ˆë‹¤. ë™ì‹œì— í™•ì¥ì„ í•˜ë”ë¼ë„, `service` ìì‹ ì˜ í•µì‹¬
   ê¸°ëŠ¥ì„ êµ¬í˜„í•œ ì½”ë“œëŠ” ê·¸ëŸ° ë³€í™”ì— ì˜í–¥ì„ ë°›ì§€ ì•Šê³  ìœ ì§€í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë³€ê²½ì—ëŠ” ë‹«í˜€ ìˆë‹¤ê³  í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì˜ ì„¤ê³„ëœ ê°ì²´ì§€í–¥ í´ë˜ìŠ¤ì˜ êµ¬ì¡°ë¥¼ ì‚´í´ë³´ë©´ OCPë¥¼ ì•„ì£¼ ì¢‹ê²Œ ì§€í‚¤ê³  ìˆìŠµë‹ˆë‹¤.

**ë†’ì€ ì‘ì§‘ë„ì™€ ë‚®ì€ ê²°í•©ë„**

ê°œë°© íì‡„ ì›ì¹™ì€ ë†’ì€ ì‘ì§‘ë„ì™€ ë‚®ì€ ê²°í•©ë„ë¼ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œì˜ ê³ ì „ì ì¸ ì›ë¦¬ë¡œë„ ì„¤ëª… ê°€ëŠ¥í•©ë‹ˆë‹¤.
ì‘ì§‘ë„ê°€ ë†’ë‹¤ëŠ” ê²ƒì€ í•˜ë‚˜ì˜ ëª¨ë“ˆ, í´ë˜ìŠ¤ê°€ í•˜ë‚˜ì˜ ì±…ì„ ë˜ëŠ” ê´€ì‹¬ì‚¬ì—ë§Œ ì§‘ì¤‘ë˜ì–´ ìˆë‹¤ëŠ” ê²ƒì„ ëœ»í•˜ê³ , 
ë¶ˆí•„ìš”í•˜ê±°ë‚˜ ì§ì ‘ ê´€ë ¨ì´ ì—†ëŠ” ì™¸ë¶€ì˜ ê´€ì‹¬ê³¼ ì±…ì„ì´ ì–½í˜€ ìˆì§€ ì•Šë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.

- **ë†’ì€ ì‘ì§‘ë„**
  - ë³€í™”ê°€ ì¼ì–´ë‚  ë•Œ í•´ë‹¹ ëª¨ë“ˆì—ì„œ ë³€í•˜ëŠ” ë¶€ë¶„ì´ í¬ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸. ì¦‰, ë³€ê²½ì´ ì¼ì–´ë‚  ë•Œ ëª¨ë“ˆì˜ ë§ì€ ë¶€ë¶„ì´ í•¨ê»˜ ë°”ë€ë‹¤ë©´ ì‘ì§‘ë„ê°€ ë†’ë‹¤ê³  ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - ëª¨ë“ˆì˜ ì¼ë¶€ë¶„ë§Œ ë³€ê²½ì´ ì¼ì–´ë‚œë‹¤ë©´, ì–´ë–¤ ë¶€ë¶„ì´ ë³€ê²½ ë˜ì—ˆëŠ”ì§€ íŒŒì•…í•˜ê¸° ì–´ë µê³ , ê·¸ ë³€ê²½ìœ¼ë¡œ ì¸í•´ ë‹¤ë¥¸ ë¶€ë¶„ì— ì˜í–¥ì„ ë¼ì¹  ìˆ˜ ë„ ìˆìŠµë‹ˆë‹¤.
  - ì‘ì—…ì€ í•­ìƒ ì „ì²´ì ìœ¼ë¡œ ì¼ì–´ë‚˜ê³  ë¬´ì—‡ì„ ë³€ê²½í• ì§€ ëª…í™•í•˜ë©°, ë³€ê²½ìœ¼ë¡œ ì¸í•´ ë‹¤ë¥¸ í´ë˜ìŠ¤ì˜ ìˆ˜ì •ì„ ìš”êµ¬í•˜ì§€ ì•Šê³ , ê¸°ëŠ¥ì—ë„ ì˜í–¥ì„ ì£¼ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **ë‚®ì€ ê²°í•©ë„**
  - ì±…ì„ê³¼ ê´€ì‹¬ì‚¬ê°€ ë‹¤ë¥¸ ì˜¤ë¸Œì íŠ¸ ë˜ëŠ” ëª¨ë“ˆê³¼ ë‚®ì€ ê²°í•©ë„, ì¦‰ ëŠìŠ¨í•˜ê²Œ ì—°ê²°ëœ í˜•íƒœë¥¼ ìœ ì§€í•˜ëŠ” ê²ƒì´ ë°”ëŒì§ í•©ë‹ˆë‹¤.
  - 'ê²°í•©ë„'ë€ í•˜ë‚˜ì˜ ì˜¤ë¸Œì íŠ¸ê°€ ë³€ê²½ì´ ì¼ì–´ë‚  ë•Œì— ê´€ê³„ë¥¼ ë§ºê³ ìˆëŠ” ë‹¤ë¥¸ ì˜¤ë¸Œì íŠ¸ì—ê²Œ ë³€í™”ë¥¼ ìš”êµ¬í•˜ëŠ” ì •ë„ë¥¼ ë§í•©ë‹ˆë‹¤.

- ì¦‰, `repository`ë¼ëŠ” ê´€ì‹¬ì‚¬ë¥¼ í•˜ë‚˜ì˜ ê´€ì‹¬ì‚¬ë¡œ ë¶„ë¦¬ í•˜ì˜€ìœ¼ë©°, ì¸í„°í˜ì´ìŠ¤ë¥¼ í™œìš©í•˜ì˜€ê¸° ë•Œë¬¸ì— ì‘ì§‘ë„ê°€ ë†’ê³ , ê²°í•©ë„ê°€ ë‚®ë‹¤ê³  í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì „ëµ íŒ¨í„´**

ì „ëµíŒ¨í„´ì€ ìì‹ ì˜ ê¸°ëŠ¥ì—ì„œ, í•„ìš”ì— ë”°ë¼ ë³€ê²½ì´ í•„ìš”í•œ ì•Œê³ ë¦¬ì¦˜ì„ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ í†µì§¸ë¡œ ì™¸ë¶€ë¡œ ë¶„ë¦¬ì‹œí‚¤ê³ , ì´ë¥¼ êµ¬í˜„í•œ êµ¬ì²´ì ì¸ ì•Œê³ ë¦¬ì¦˜ í´ë˜ìŠ¤ë¥¼ í•„ìš”ì— ë”°ë¼ ë°”ê¿”ì„œ
ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë””ìì¸ íŒ¨í„´ì„ ë§í•©ë‹ˆë‹¤.
ì¦‰, ì»¨í…ìŠ¤íŠ¸(`service`)ë¥¼ ì‚¬ìš©í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸(`AppConfig`)ëŠ” ì»¨í…ìŠ¤íŠ¸ê°€ ì‚¬ìš©í•  ì „ëµ(`repository`)ë¥¼ ì»¨í…ìŠ¤íŠ¸ì˜ ìƒì„±ìë“±ì„ í†µí•´ ì œê³µí•´ì£¼ëŠ” ê²ƒì„ ë§í•©ë‹ˆë‹¤.

**ì§€ê¸ˆ ê¹Œì§€ ê°œì„ í•´ì˜¨ ì½”ë“œê°€ OCP, ë†’ì€ ì‘ì§‘ë„, ë‚®ì€ ê²°í•©ë„, ì „ëµ íŒ¨í„´ì„ ì˜ ì§€ì¼°ìŒì„ ì¦ëª…í–ˆìŠµë‹ˆë‹¤.**

**ìŠ¤í”„ë§ì´ë€ ê°ì²´ì§€í–¥ì  ì„¤ê³„ ì›ì¹™ê³¼ ë””ìì¸ íŒ¨í„´ì— ë‚˜íƒ€ë‚œ ì¥ì ì„ ìì—°ìŠ¤ëŸ½ê²Œ ê°œë°œìë“¤ì´ í™œìš©í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤.**

***
## ğŸš€ ì œì–´ì˜ ì—­ì „(IOC)

### ğŸ”§ íŒ©í† ë¦¬
ê°ì²´ì˜ ìƒì„± ë°©ë²•ì„ ê²°ì •í•˜ê³  ê·¸ë ‡ê²Œ ë§Œë“¤ì–´ì§„ ì˜¤ë¸Œì íŠ¸ë¥¼ ëŒë ¤ì£¼ëŠ” ì¼ì„ í•˜ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ ëœ»í•©ë‹ˆë‹¤.
ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” ìª½ê³¼ ìƒì„±ëœ ì˜¤ë¸Œì íŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ìª½ì˜ ì—­í• ê³¼ ì±…ì„ì„ ê¹”ë”í•˜ê²Œ ë¶„ë¦¬í•˜ë ¤ëŠ” ëª©ì ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.

ì´ëŠ”, Ver 5. ì—ì„œ ë§Œë“¤ì–´ë´¤ë˜ `AppConfig` ì™€ ê°™ì€ í´ë˜ìŠ¤ë¥¼ ëœ»í•©ë‹ˆë‹¤.

```java
@RequiredArgsConstructor
public class AppConfig {

    private final EntityManager em;

    public UserRepositoryV5 userRepository(){
        return new UserRepositoryV5Impl(em);
    }

    public UserServiceV5 userService(){
        return new UserServiceV5(userRepository());
    }
}
```

`service` -> `repository` ì™€ ê°™ì€ ì˜ì¡´ ê´€ê³„ë¥¼ í˜•ì„±í•˜ê³  ìˆì„ ë•Œ, ìƒˆë¡œìš´ `repository` êµ¬í˜„ í´ë˜ìŠ¤ë¡œ ë³€ê²½ì´ í•„ìš”í•˜ë©´ `AppConfig`í´ë˜ìŠ¤ë§Œ ìˆ˜ì •í•´ì£¼ë©´ ë©ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ìë©´, `repositoryImplV1` ê³¼ `repositoryImplV2`ì™€ ê°™ì€ `repository`êµ¬í˜„ì²´ê°€ ìˆì„ ë•Œ,
```java
@RequiredArgsConstructor
public class AppConfig {

    private final EntityManager em;

    public UserRepositoryV5 userRepository(){
       // return new UserRepositoryV5Impl(em);
      return new UserRepositoryV5ImplV2(em);
    }

    public UserServiceV5 userService(){
        return new UserServiceV5(userRepository());
    }
}
```
ì´ëŸ° ì‹ìœ¼ë¡œë§Œ, ë°”ê¿”ì¤€ë‹¤ë©´ ë˜ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

### ğŸ”§ ì œì–´ê¶Œì˜ ì´ì „ì„ í†µí•œ ì œì–´ê´€ê³„ ì—­ì „

ì¼ë°˜ì ì¸ í”„ë¡œê·¸ë¨ì˜ íë¦„ì€ main() ë©”ì†Œë“œì™€ ê°™ì€ í”„ë¡œê·¸ë¨ì´ ì‹œì‘ë˜ëŠ” ì§€ì ì—ì„œ ì‚¬ìš©í•  ì˜¤ë¸Œì íŠ¸, ì˜¤ë¸Œì íŠ¸ì˜ ë©”ì†Œë“œ í˜¸ì¶œ ë“±ë“± 
ëª¨ë“  ì¢…ë¥˜ì˜ ì‘ì—…ì„ ì‚¬ìš©ìê°€ ëŠ¥ë™ì ìœ¼ë¡œ, ì§ì ‘ ì œì–´í•˜ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.

**ì œì–´ì˜ ì—­ì „ì´ë€ ì´ëŸ° ì¼ë°˜ì ì¸ í”„ë¡œê·¸ë¨ì˜ íë¦„ì„ ê±°ê¾¸ë¡œ ë’¤ì§‘ëŠ” ê²ƒ ì…ë‹ˆë‹¤.**

ì œì–´ì˜ ì—­ì „ì—ì„œëŠ” ìì‹ ì´ ì‚¬ìš©í•  ì˜¤ë¸Œì íŠ¸ë¥¼ ê²°ì •í•˜ì§€ ì•Šì„ ë¿ë”ëŸ´ ìƒì„±ì¡°ì°¨ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
ëª¨ë“  ì œì–´ ê¶Œí•œì„ ìì‹ ì´ ì•„ë‹Œ ë‹¤ë¥¸ ëŒ€ìƒì—ê²Œ ìœ„ì„í•˜ëŠ” ê²ƒì„ ëœ»í•©ë‹ˆë‹¤.

í”íˆ, ìŠ¤í”„ë§ê³¼ ê°™ì€ í”„ë ˆì„ì›Œí¬ëŠ” ì œì–´ì˜ ì—­ì „ ê°œë…ì´ ì ìš©ëœ ëŒ€í‘œì ì¸ ê¸°ìˆ ì´ë¼ê³  í•©ë‹ˆë‹¤.
í”„ë ˆì„ì›Œí¬ì™€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í˜¼ë™í• ìˆ˜ë„ ìˆëŠ”ë° ë‘˜ì€ ì—„ì—°íˆ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤.
- ë¼ì´ë¸ŒëŸ¬ë¦¬
  - ë™ì‘í•˜ëŠ” ì¤‘ì— í•„ìš”í•œ ê¸°ëŠ¥ì´ ìˆì„ ë•Œ, ëŠ¥ë™ì ìœ¼ë¡œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©. ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ íë¦„ì€ ì§ì ‘ ì œì–´
- í”„ë ˆì„ì›Œí¬
  - ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œê°€ í”„ë ˆì„ì›Œí¬ì— ì˜í•´ ì‚¬ìš©.
  - í”„ë ˆì„ì›Œí¬ ìœ„ì— ê°œë°œí•œ í´ë˜ìŠ¤ë¥¼ ë“±ë¡í•´ë‘ê³ , í”„ë ˆì„ì›Œí¬ê°€ íë¦„ì„ ì£¼ë„í•˜ëŠ” ì¤‘ì— ê°œë°œìê°€ ë§Œë“  ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹.

ì§€ê¸ˆ, ìš°ë¦¬ê°€ ë§Œë“  `repository` ì™€ `service` ì‚¬ì´ì—ì„œë„ ì œì–´ì˜ ì—­ì „ì´ ì ìš© ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
ì¼ë°˜ì ì¸ í”„ë¡œê·¸ë¨ì˜ ê²½ìš°, `repository`ì˜ êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ê²°ì •í•˜ê³  ì˜¤ë¸Œì íŠ¸ë¥¼ ë§Œë“œëŠ” ê²°ì •ê¶Œí•œì€ `service`ì— ìˆì„ ê²ƒì…ë‹ˆë‹¤.
ê·¸ëŸ¬ë‚˜, ì§€ê¸ˆìŒ `AppConfig`ì— ìˆìŠµë‹ˆë‹¤. `service`ëŠ” ëŠ¥ë™ì ì¸ ì¡´ì¬ê°€ ì•„ë‹Œ, ìˆ˜ë™ì ì¸ ì¡´ì¬ê°€ ë˜ì—ˆë‹¤ê³ ê³  ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
`service`ëŠ” ìê¸° ìì‹ ë„ ìˆ˜ë™ì ìœ¼ë¡œ ë§Œë“¤ì–´ ì§€ë©°, ì‚¬ìš©í•  ì˜¤ë¸Œì íŠ¸ ë˜í•œ ìˆ˜ë™ì ìœ¼ë¡œ ê³µê¸‰ ë°›ê²Œ ë©ë‹ˆë‹¤.

í˜„ì¬ ì§€ê¸ˆ ë§Œë“  ê²ƒì€ ê°€ì¥ ë‹¨ìˆœí•œ IOC í”„ë ˆì„ì›Œí¬ë¥¼ ë§Œë“¤ì—ˆë‹¤ê³  ë³´ë©´ ë ê²ƒì´ê³ , ì´ì œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ë°˜ì— ê±¸ì³ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ëŒ€í‘œì ì¸ IOC í”„ë ˆì„ì›Œí¬ì¸
**ìŠ¤í”„ë§ì˜ ë„ì›€ì´ í•„ìš”í•˜í•©ë‹ˆë‹¤.(ì»´í¬ë„ŒíŠ¸ì˜ ìƒì„±ê³¼ ê´€ê³„ì„¤ì •, ì‚¬ìš©, ìƒëª…ì£¼ê¸° ê´€ë¦¬ë“±ì„ ê´€ì¥í•˜ëŠ” ì¡´ì¬)**

***

## ğŸš€ ìŠ¤í”„ë§ IOC

ìŠ¤í”„ë§ì˜ í•µì‹¬ì„ ë‹´ë‹¹í•˜ëŠ” ê²ƒì€ ë¹ˆ íŒ©í† ë¦¬ ë˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ë¼ê³  ë¶ˆë¦¬ëŠ” ê²ƒì…ë‹ˆë‹¤. í•œë²ˆ ì•Œì•„ë³´ì£ ~!

### ğŸ”§ ì˜¤ë¸Œì íŠ¸ íŒ©í† ë¦¬ë¥¼ ì´ìš©í•œ ìŠ¤í”„ë§ IOC

- ìŠ¤í”„ë§ ë¹ˆ
  - ìŠ¤í”„ë§ì—ì„œëŠ” ìŠ¤í”„ë§ì´ ì œì–´ê¶Œì„ ê°€ì§€ê³  ì§ì ‘ ë§Œë“¤ê³  ê´€ê³„ë¥¼ ë¶€ì—¬í•˜ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ ë¹ˆì´ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤. ë˜í•œ, ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ìƒì„±ê³¼ ê´€ê³„ì„¤ì •, ì‚¬ìš©ë“¤ì„ ì œì–´í•´ì£¼ëŠ” 
  ì œì–´ì˜ ì—­ì „ì´ ì ìš©ëœ ì˜¤ë¸Œì íŠ¸ë¥¼ ê°€ë¦¬í‚¤ëŠ” ë§ì…ë‹ˆë‹¤.

**ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸, ë¹ˆ íŒ©í† ë¦¬**
- ë¹ˆì˜ ìƒì„±ê³¼ ê´€ê³„ì„¤ì • ê°™ì€ ì œì–´ë¥¼ ë‹´ë‹¹í•˜ëŠ” IOC ì˜¤ë¸Œì íŠ¸ë¥¼ ë¹ˆ íŒ©í† ë¦¬ ë˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.
- ë³„ë„ì˜ ì„¤ì • ì •ë³´(ì˜¤ë¸Œì íŠ¸ë¥¼ ì–´ë–»ê²Œ ìƒì„±í•˜ê³ , ì–´ë–¤ ì˜ì¡´ê´€ê³„ë¥¼ ë§ºì–´ì£¼ê³ )ë¥¼ ì°¸ê³ í•´ì„œ ë¹ˆì˜ ìƒì„±, ê´€ê³„ì„¤ì • ë“±ì˜ ì œì–´ ì‘ì—…ì„ ì´ê´„í•©ë‹ˆë‹¤.

ì„¤ì •ì •ë³´ë¥¼ ë§Œë“œëŠ” ë°©ë²•ì€ ì—¬ëŸ¬ê°€ì§€ê°€ ìˆëŠ”ë°,

**AppConfig.java**
```java
@RequiredArgsConstructor
public class AppConfig {

    private final EntityManager em;

    public UserRepositoryV5 userRepository(){
        return new UserRepositoryV5Impl(em);
    }

    public UserServiceV5 userService(){
        return new UserServiceV5(userRepository());
    }
}
```
ì´ëŸ¬í•œ (ë¡¬ë³µì„ ì‚¬ìš©í•˜ê¸´ í–ˆì§€ë§Œ?) ìˆœìˆ˜ ìë°” ì½”ë“œë„, ìŠ¤í”„ë§ ì• ë…¸í…Œì´ì…˜ì„ í™œìš©í•˜ ê°„ë‹¨í•˜ê²Œ ì„¤ì •ì •ë³´ë¥¼ ë§Œë“¤ì–´ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì„¤ì • ì •ë³´ ë§Œë“œëŠ” ë°©ë²•**
1. ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ë¥¼ ìœ„í•œ ì˜¤ë¸Œì íŠ¸ ì„¤ì •ì„ ë‹´ë‹¹í•˜ëŠ” í´ë˜ìŠ¤ë¼ê³  ì¸ì‹í• ìˆ˜ ìˆë„ë¡ `@Configuration`ì´ë¼ëŠ” ì–´ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
2. ì˜¤ë¸Œì íŠ¸ë¥¼ ë§Œë“¤ì–´ì£¼ëŠ” ë©”ì†Œë“œì—ëŠ” `@Bean`ì´ë¼ëŠ” ì• ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•©ë‹ˆë‹¤.

**AppConfig.java**
```java
@Configuration
public class SpringAppConfigV1 {

    @Bean
    @Primary
    public LocalEntityManagerFactoryBean getEmf(){
        LocalEntityManagerFactoryBean emf=new LocalEntityManagerFactoryBean();
        emf.setPersistenceUnitName("hello");
        return emf;
    }

    @Bean
    @Primary
    public EntityManager getEm(){
        return getEmf().getObject().createEntityManager();
    }

    @Bean
    public UserRepositoryV5 userRepository(){
        return new UserRepositoryV5Impl(getEm());
    }

    @Bean
    public UserServiceV5 userService(){
        return new UserServiceV5(userRepository());
    }
}
```

>í˜„ì¬, ì´ ì„¤ì • ì •ë³´ì—ì„œëŠ” EntityManager Beanì„ ì§ì ‘ ë§Œë“¤ì–´ì¤¬ìŠµë‹ˆë‹¤. í—Œì¬ê¹Œì§€ëŠ”, ìŠ¤í”„ë§ ë¶€íŠ¸ì—ì„œ ìë™ ì£¼ì…í•˜ì—¬ ì£¼ëŠ” EntityManagerë¥¼ ì‚¬ìš©í•´ì£¼ì—ˆìŠµë‹ˆë‹¤., ì§€ê¸ˆ 
> ì´ ì„¤ì •ì •ë³´ í´ë˜ìŠ¤ì—ì„œëŠ” ì•„ì§ ìŠ¤í”„ë§ ë¶€íŠ¸ì—ì„œ ë§Œë“  EntityManager Beanì´ ì¡´ì¬í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ë”°ë¡œ EntityManager Beanê³¼ TransactionManager Beanì„
> ë§Œë“¤ì–´ì•¼í•©ë‹ˆë‹¤. ì €ëŠ” Transactionì´ ì¡´ì¬í•˜ì§€ ì•Šì•„ë„ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ëŠ”ë°ëŠ” ë¬´ë¦¬ê°€ ì—†ë‹¤ ìƒê°í•˜ì—¬, EntityManagerë§Œ ìƒì„±í•´ ì£¼ì—ˆê³ 
> ìŠ¤í”„ë§ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë¡œë“œë ë•Œ, ìŠ¤í”„ë§ ë¶€íŠ¸ì—ì„œ ë§Œë“œëŠ” EntityManagerì™€ í˜¼ë™ì´ ìƒê¸¸ ìˆ˜ ìˆìœ¼ë¯€ë¡œ @Primary ì• ë…¸í…Œì´ì…˜ì„ ì¶”ê°€ë¡œ ë¶™ì—¬ ì£¼ì—ˆìŠµë‹ˆë‹¤.

**persistence.xml**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<persistence version="2.2"
             xmlns="http://xmlns.jcp.org/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_2.xsd">
    <persistence-unit name="hello">
        <properties>
            <!-- í•„ìˆ˜ ì†ì„± -->
            <property name="javax.persistence.jdbc.driver" value="org.h2.Driver"/>
            <property name="javax.persistence.jdbc.user" value="sa"/>
            <property name="javax.persistence.jdbc.password" value=""/>
            <property name="javax.persistence.jdbc.url" value="jdbc:h2:tcp://localhost/~/dependencytest"/>
            <property name="hibernate.dialect" value="org.hibernate.dialect.H2Dialect"/>

            <!-- ì˜µì…˜ -->
            <property name="hibernate.show_sql" value="true"/>
            <property name="hibernate.format_sql" value="true"/>
            <property name="hibernate.use_sql_comments" value="true"/>
            <!--<property name="hibernate.hbm2ddl.auto" value="create" />-->
        </properties>
    </persistence-unit>
</persistence>
```

ì´ë ‡ê²Œ, ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ê°€ Iocë°©ì‹ì˜ ê¸°ëŠ¥ì„ ì œê³µí•  ë•Œ ì‚¬ìš©í•  ì™„ë²½í•œ ì„¤ì •ì •ë³´ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

ì´ì œ, í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ í†µí•´ ApplicationContextë¥¼ ë§Œë“¤ì–´ë´…ì‹œë‹¤.
1. AnnotationConfigApplicationContextë¥¼ ì´ìš©í•˜ì—¬ ì„¤ì •ì •ë³´ë¥¼ ì ìš©í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ ìƒì„±
2. getBean() ë©”ì†Œë“œë¥¼ í™œìš©í•˜ì—¬ ì„¤ì •ì •ë³´ì— ì •ì˜í•´ ë†“ì€ Beanì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**SpringAppConfigTest.java**
```java
@SpringBootTest
@Transactional
public class SpringAppConfigV1Test {

    @Test
    @DisplayName("Bean Test")
    void ë¹ˆ_í…ŒìŠ¤íŠ¸(){
        User user=createUser("hong","123");

        AnnotationConfigApplicationContext ac=new AnnotationConfigApplicationContext(SpringAppConfigV1.class);

        UserServiceV5 userService= ac.getBean("userService",UserServiceV5.class);

        Long saveId = userService.join(user);

        User findUser = userService.findOne(saveId);

        Assertions.assertThat(findUser.getName()).isEqualTo(user.getName());
        Assertions.assertThat(findUser.getPassword()).isEqualTo(user.getPassword());
    }

    private User createUser(String name, String password){
        return User.createUser()
                .name(name)
                .password(password)
                .build();
    }
}
```

**ë™ì‘ í™•ì¸**

<img width="50%" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-10-04 á„‹á…©á„’á…® 10 51 11" src="https://user-images.githubusercontent.com/56334761/135863453-16dabc5d-9450-468e-9d3c-722aea2d98bc.png">

ë™ì‘ í™•ì¸ ê¹Œì§€ í•˜ì˜€ìŠµë‹ˆë‹¤. ê·¸ëŸ°ë° ì´ë ‡ê²Œ ë´ì„œëŠ” ë” ë²ˆê±°ë¡œìš¸ ë¿ì´ì§€ ë”±íˆ ì¥ì ì€ ì—†ì–´ë³´ì…ë‹ˆë‹¤.

ì´ëŸ¬í•œ ê³ ë¯¼ì€, ìŠ¤í”„ë§ì€ ë‚ ë ¤ë²„ë¦¬ë¼ê³  í•©ë‹ˆë‹¤. ì–»ì„ ìˆ˜ ì—†ëŠ” ë°©ëŒ€í•œ ê¸°ëŠ¥ì„ ì œê³µí• í…Œë‹ˆ..

### ğŸ”§ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ì˜ ë™ì‘ë°©ì‹

ì˜¤ë¸Œì íŠ¸ íŒ©í† ë¦¬ì™€ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸

ì‚¬ìš© ë°©ì‹ ë° ì„¤ì • ì •ë³´ ë¨¼ì € ë³´ì‹œì£ .

**ì˜¤ë¸Œì íŠ¸ íŒ©í† ë¦¬**

```java
@RequiredArgsConstructor
public class AppConfig {

    private final EntityManager em;

    public UserRepositoryV5 userRepository(){
        return new UserRepositoryV5Impl(em);
    }

    public UserServiceV5 userService(){
        return new UserServiceV5(userRepository());
    }
}
```
```java
AppConfig appConfig=new AppConfig(em);
UserServiceV5 userService= appConfig.userService();
```

**ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸**
```java
@Configuration
public class SpringAppConfigV1 {

    @Bean
    @Primary
    public LocalEntityManagerFactoryBean getEmf(){
        LocalEntityManagerFactoryBean emf=new LocalEntityManagerFactoryBean();
        emf.setPersistenceUnitName("hello");
        return emf;
    }

    @Bean
    @Primary
    public EntityManager getEm(){
        return getEmf().getObject().createEntityManager();
    }

    @Bean
    public UserRepositoryV5 userRepository(){
        return new UserRepositoryV5Impl(getEm());
    }

    @Bean
    public UserServiceV5 userService(){
        return new UserServiceV5(userRepository());
    }
}
```
```java
AnnotationConfigApplicationContext ac=new AnnotationConfigApplicationContext(SpringAppConfigV1.class);
UserServiceV5 userService= ac.getBean("userService",UserServiceV5.class);

```

ì—¬ê¸°ì„œ ë³´ì‹œë©´, ì˜¤ë¸Œì íŠ¸ íŒ©í† ë¦¬ëŠ” `service` ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•˜ê³  `repository`ì™€ ê´€ê³„ë¥¼ ë§ºì–´ì£¼ëŠ” ì œí•œì ì¸ ì—­í• ì„ í•˜ëŠ” ë°ì— ë°˜í•´,
ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ëŠ” IOCë¥¼ ì ìš©í•´ì„œ ê´€ë¦¬í•  ëª¨ë“  ì˜¤ë¸Œì íŠ¸ì— ëŒ€í•œ ìƒì„±ê³¼ ê´€ê³„ì„¤ì •ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.

ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ëŠ” @Configuration ì´ ë¶™ì€ ì„¤ì • ì •ë³´ë¥¼ í™œìš©í•˜ì—¬ ë“±ë¡ ëœ ë¹ˆì„ í˜¸ì¶œí•´ì„œ ê°€ì ¸ì˜¨ ê²ƒì„ í´ë¼ì´ì–¸íŠ¸ê°€ getBean()ì„ ìš”ì²­í•  ë•Œ 
ì „ë‹¬í•´ ì¤ë‹ˆë‹¤.

ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ëŠ” ë²”ìš©ì ì´ê³  ìœ ì—°í•œ ë°©ë²•ìœ¼ë¡œ Iocê¸°ëŠ¥ì„ í™•ì¥í•˜ê¸° ìœ„í•´ì„œ ì…ë‹ˆë‹¤. ì´ë ‡ê²Œë§Œ í•´ì„œëŠ” ì•„ì§ ê¹Œì§€ë„ ì¥ì ì´ ë­”ì§€
ê°ì´ ì•ˆì¡í™ë‹ˆë‹¤. ìì„¸íˆ ì‚´í´ë³´ì£ .

**ì• í”Œë ˆí‚¹ì…˜ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í–ˆì„ ë•Œì˜ ì¥ì **
- í´ë¼ì´ì–¸íŠ¸ëŠ” êµ¬ì²´ì ì¸ íŒ©í† ë¦¬ í´ë˜ìŠ¤ë¥¼ ì•Œ í•„ìš” ì—†ë‹¤.
  - ì• í”Œë¦¬ì¼€ì´ì…˜ ë°œì „ì‹œ, IoCë¥¼ ì ìš©í•œ ì˜¤ë¸Œì íŠ¸ë„ ê³„ì† ì¶”ê°€ë  ê²ƒ, í´ë¼ì´ì–¸íŠ¸ê°€ í•„ìš”í•œ ì˜¤ë¸Œì íŠ¸ë¥¼ ê°€ì ¸ì˜¤ë ¤ë©´ ì–´ë–¤ íŒ©í† ë¦¬ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš© í–ˆëŠ”ì§€ë¥¼ ì•Œì•„ì•¼ í•˜ê³ ,
  í•„ìš”í•  ë•Œ ë§ˆë‹¤ íŒ©í† ë¦¬ ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•´ì•¼í•˜ëŠ” ë²ˆê±°ë¡œì›€ì´ ìˆìŠµë‹ˆë‹¤. (`AppConfig ac=new AppConfg()`, ìƒˆë¡œìš´ íŒ©í† ë¦¬ì¸ DaoFactoryê°€ ë§Œë“¤ì–´ ì¡Œë‹¤ë©´
  `DaoFactory da=new DaoFactory()` ì´ë ‡ê²Œ êµ¬ì²´ì ìœ¼ë¡œ ì•Œì•„ì•¼ í•¨.)
  - ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ë¥¼ í™œìš©í•˜ê²Œ ë˜ë©´ ì¼ê´€ëœ ë°©ì‹ìœ¼ë¡œ ì›í•˜ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.(`AnnotaionConfigApplicationContext ac=new Annotaion
  ConfigApplication(@Configurationì´ ë¶™ì€ í´ë˜ìŠ¤)`)
- ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ëŠ” ì¢…í•© IoC ì„œë¹„ìŠ¤ë¥¼ ì œê³µ.
  - ì˜ì¡´ê´€ê³„ë¥¼ ë§ºì–´ì£¼ëŠ” ê²ƒ ì´ìƒìœ¼ë¡œ ì˜¤ë¸Œì íŠ¸ê°€ ë§Œë“¤ì–´ì§€ëŠ” ë°©ì‹, ì‹œì ê³¼ ì „ëµ ë“±ë“± íš¨ê³¼ì ì¸ ë‹¤ì–‘í•œ ê¸°ëŠ¥ë“¤ì„ ì œê³µí•©ë‹ˆë‹¤.
- ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ëŠ” ë¹ˆì„ ê²€ìƒ‰í•˜ëŠ” ë‹¤ì–‘í•œ ë°©ë²•ì„ ì œê³µ
***
## ğŸš€ ì‹±ê¸€í†¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì™€ ì˜¤ë¸Œì íŠ¸ ìŠ¤ì½”í”„

### âœï¸ ì˜¤ë¸Œì íŠ¸ì˜ ë™ì¼ì„±ê³¼ ë™ë“±ì„±
ìë°”ì—ì„œëŠ” ë‘ ê°œì˜ ì˜¤ë¸Œì íŠ¸ê°€ ì™„ì „íˆ ê°™ì€ ë™ì¼í•œ ì˜¤ë¸Œì íŠ¸ë¼ ë§í•˜ëŠ” ê²ƒê³¼, ë™ì¼í•œ ì •ë³´ë¥¼ ë‹´ê³ ìˆëŠ” ì˜¤ë¸Œì íŠ¸ë¼ê³  ë§í•˜ëŠ” ê²ƒì€ ë¶„ëª…í•œ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤.
ì „ìëŠ” ë™ì¼ì„±ë¹„êµë¼ê³  í•˜ê³ , í›„ìë¥¼ ë™ë“±ì„± ë¹„êµë¼ê³  í•©ë‹ˆë‹¤.

- ë™ì¼ì„±
  - ë‘ ê°œì˜ ì˜¤ë¸Œì íŠ¸ê°€ ë™ì¼í•˜ë‹¤ë©´ ì‚¬ì‹¤ì€ í•˜ë‚˜ì˜ ì˜¤ë¸Œì íŠ¸ë§Œ ì¡´ì¬í•˜ëŠ” ê²ƒì´ê³  ë‘ ê°œì˜ ì˜¤ë¸Œì íŠ¸ ë ˆí¼ëŸ°ìŠ¤ ë³€ìˆ˜ë¥¼ ê°–ê³  ìˆì„ ë¿
- ë™ë“±ì„±
  - ë‘ ê°œì˜ ê°ê¸° ë‹¤ë¥¸ ì˜¤ë¸Œì íŠ¸ê°€ ë©”ëª¨ë¦¬ìƒì— ì¡´ì¬í•˜ëŠ” ê²ƒ, ë³€ìˆ˜ ëª…ì´ ê°™ë‹¤ê±°ë‚˜ ë“±ë“± ì ì ˆí•œ ë™ë“±ì„± ê¸°ì¤€ì„ ë‘ê³  íŒë‹¨

**ìŠ¤í”„ë§ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ì™€ ìˆœìˆ˜ ìë°” ì½”ë“œë¡œ ë§Œë“  ì˜¤ë¸Œì íŠ¸ íŒ©í† ë¦¬ì˜ ë™ì¼ì„±ì„ íŒë³„í•´ë´…ì‹œë‹¤.**

**ì˜¤ë¸Œì íŠ¸ íŒ©í† ë¦¬**

```java
@RequiredArgsConstructor
public class AppConfig {

    private final EntityManager em;

    public UserRepositoryV5 userRepository(){
        return new UserRepositoryV5Impl(em);
    }

    public UserServiceV5 userService(){
        return new UserServiceV5(userRepository());
    }
}
```

**ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸**
```java
@Configuration
public class SpringAppConfigV1 {

    @Bean
    @Primary
    public LocalEntityManagerFactoryBean getEmf(){
        LocalEntityManagerFactoryBean emf=new LocalEntityManagerFactoryBean();
        emf.setPersistenceUnitName("hello");
        return emf;
    }

    @Bean
    @Primary
    public EntityManager getEm(){
        return getEmf().getObject().createEntityManager();
    }

    @Bean
    public UserRepositoryV5 userRepository(){
        return new UserRepositoryV5Impl(getEm());
    }

    @Bean
    public UserServiceV5 userService(){
        return new UserServiceV5(userRepository());
    }
}
```

**í…ŒìŠ¤íŠ¸ ì½”ë“œ**

```java
@Transactional
public class SingletonTest {

    @Autowired
    EntityManager em;


    @Test
    @DisplayName("ìë°” ì½”ë“œë¡œ ìƒì„±í•œ íŒ©í† ë¦¬ í…ŒìŠ¤íŠ¸")
    void ìë°”_ì˜¤ë¸Œì íŠ¸_í…ŒìŠ¤íŠ¸(){
        AppConfig appConfig=new AppConfig(em);
        UserServiceV5 userService1=appConfig.userService();
        UserServiceV5 userService2=appConfig.userService();

        Assertions.assertThat(userService1).isNotEqualTo(userService2);
    }

    @Test
    @DisplayName("ìŠ¤í”„ë§ ë¹ˆ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ í…ŒìŠ¤íŠ¸")
    void ìŠ¤í”„ë§_ë¹ˆ_í…ŒìŠ¤íŠ¸(){
        AnnotationConfigApplicationContext ac=new AnnotationConfigApplicationContext(SpringAppConfigV1.class);

        UserServiceV5 userService1=ac.getBean("userService",UserServiceV5.class);
        UserServiceV5 userService2=ac.getBean("userService",UserServiceV5.class);

        Assertions.assertThat(userService1).isEqualTo(userService2);
    }
}
```

**ê²°ê³¼í™•ì¸**

<img width="50%" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-10-13 á„‹á…©á„’á…® 9 02 05" src="https://user-images.githubusercontent.com/56334761/137128721-1efa7c32-af8c-4ec5-87d4-540228ddf82a.png">

ê²°ê³¼ë¥¼ ë³´ì‹œë©´ ìë°” ì½”ë“œë¡œ ìƒì„±í•œ íŒ©í† ë¦¬ í´ë˜ìŠ¤ëŠ” ë§¤ë²ˆ ìƒì„±ì‹œ **ë™ì¼ì„±ì„ ì¶©ì¡±í•˜ì§€ ì•Šì•˜ê³ **,
ìŠ¤í”„ë§ ë¹ˆ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ëŠ” **ë™ì¼ì„±ì„ ì¶©ì¡±**í–ˆë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ğŸ”§ ì‹±ê¸€í†¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¡œì„œì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸

ë¨¼ì € ê³µë¶€í–ˆì„ë•Œ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ IOCì»¨í…Œì´ë„ˆë¼ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
ì¶”ê°€ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ëŠ” ì‹±ê¸€í†¤ì„ ì €ì¥í•˜ê³  ê´€ë¦¬í•˜ëŠ” ì‹±ê¸€í†¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì…ë‹ˆë‹¤.

ìŠ¤í”„ë§ì€ ê¸°ë³¸ì ìœ¼ë¡œ ë³„ë‹¤ë¥¸ ì„¤ì •ì„ í•˜ì§€ ì•Šìœ¼ë©´ ë‚´ë¶€ì—ì„œ ìƒì„±í•˜ëŠ” ë¹ˆ ì˜¤ë¸Œì íŠ¸ë¥¼ ëª¨ë‘ ì‹±ë“¤í†¤ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤.

**ì„œë²„ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ì‹±ê¸€í†¤**

**ê·¼ë³¸ì ì¸ ì§ˆë¬¸! ê·¸ë ‡ë‹¤ë©´ ìŠ¤í”„ë§ì€ ì™œ ì‹±ê¸€í†¤ìœ¼ë¡œ ë¹ˆì„ ìƒì„±í• ê¹Œ?**

ìŠ¤í”„ë§ì´ ì²˜ìŒ ì„¤ê³„ëë˜ ì´ìœ ë¡œë¶€í„° ë¹„ë¡¯ë©ë‹ˆë‹¤. ìŠ¤í”„ë§ì€ ì´ˆë‹¹ ì—„ì²­ë‚œ ìˆ˜ì˜ ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ë†’ì€ ì„±ëŠ¥ì´ ìš”êµ¬ë˜ë©°, í•˜ë‚˜ì˜ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´
 ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ë‹´ë‹¹í•˜ëŠ” ë¬´ìˆ˜íˆ ë§ì€ ì˜¤ë¸Œì íŠ¸ë“¤ì´ ê³„ì¸µí˜•ìœ¼ë¡œ ì´ë£¨ì–´ì ¸ ìˆìŠµë‹ˆë‹¤.

ê·¸ëŸ°ë° ë§¤ë²ˆ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì´ ì˜¬ ë•Œë§ˆë‹¤ ê° ë¡œì§ì„ ë‹´ë‹¹í•˜ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒˆë¡œë§Œë“¤ì–´ì„œ ì‚¬ìš©í•œë‹¤ë©´ ì—„ì²­ë‚œ ë¶€í•˜ê°€ ê±¸ë¦¬ê²Œ ë˜ê² ì£ ?!

**ê·¸ë ‡ê¸°ì—, ìŠ¤í”„ë§ì€ ì‹±ê¸€í†¤ìœ¼ë¡œ ë¹ˆì„ ìƒì„±í•˜ê²Œ ë©ë‹ˆë‹¤.**

- ì‹±ê¸€í†¤ íŒ¨í„´ì˜ ì›ë¦¬
  - ì• í”Œë¦¬ì¼€ì´ì…˜ ì•ˆì— ì œí•œëœ ìˆ˜, ëŒ€ê°œ í•œ ê°œì˜ ì˜¤ë¸Œì íŠ¸ë§Œ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒ

**í•˜ì§€ë§Œ, ì‹±ê¸€í†¤ íŒ¨í„´ì„ ì‚¬ìš©í•˜ê¸°ëŠ” ê¹Œë‹¤ë¡­ê³  ì—¬ëŸ¬ê°€ì§€ ë¬¸ì œê°€ ìˆë‹¤ê³  í•©ë‹ˆë‹¤.**

- ìë°”ì—ì„œ ì‹±ê¸€í†¤ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•
  1. ë‹¤ë¥¸ ê³³ì—ì„œëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•˜ì§€ ëª»í•˜ë„ë¡ privateë¡œ ì ‘ê·¼ì„ ì œí•œ
  2. ìƒì„±ëœ ì‹±ê¸€í†¤ ì˜¤ë¸Œì íŠ¸ë¥¼ ì €ì¥í•  ìˆ˜ ìˆëŠ” ìì‹ ê³¼ ê°™ì€ íƒ€ì…ì˜ ìŠ¤íƒœí‹± í•„ë“œë¥¼ ì •ì˜
  3. í•œ ë²ˆ ì˜¤ë¸Œì íŠ¸ê°€ ë§Œë“¤ì–´ì§€ê³  ë‚œ ë’¤ì—ëŠ” ë©”ì†Œë“œë¥¼ í†µí•˜ì—¬ ì´ë¯¸ ë§Œë“¤ì–´ì ¸ ìŠ¤íƒœí‹± í•„ë“œì— ì €ì¥í•´ë‘” ì˜¤ë¸Œì íŠ¸ë¥¼ ë„˜ê²¨ì¤Œ

**ì‹±ê¸€í†¤ íŒ¨í„´ì˜ í•œê³„**
1. private ìƒì„±ìë¥¼ ê°–ê³  ìˆê¸° ë•Œë¬¸ì— ìƒì† ë¶ˆê°€.
2. í…ŒìŠ¤íŠ¸í•˜ê¸°ê°€ ì–´ë ¤ì›Œì§
   - ì‹±ê¸€í†¤ì€ ì´ˆê¸°í™” ê³¼ì •ì—ì„œ ìƒì„±ìë“±ì„ í†µí•´ ì‚¬ìš©í•  ì˜¤ë¸Œì íŠ¸ë¥¼ ë‹¤ì´ë‚´ë¯¹í•˜ê²Œ ì£¼ì…í•˜ê¸°ê°€ í˜ë“¬
3. ì„œë²„í™˜ê²½ì—ì„œëŠ” ì‹±ë“¤í†¤ì´ í•˜ë‚˜ë§Œ ë§Œë“¤ì–´ì§€ëŠ” ê²ƒì„ ë³´ì¥í•˜ì§€ ëª»í•¨
   - ì„œë²„ì—ì„œ í´ë˜ìŠ¤ ë¡œë”ë¥¼ ì–´ë–»ê²Œ êµ¬ì„±í•˜ê³  ìˆëŠëƒì— ë”°ë¼ì„œ ì‹±ê¸€í†¤ í´ë˜ìŠ¤ì„ì—ë„ í•˜ë‚˜ ì´ìƒì˜ í´ë˜ìŠ¤ê°€ ë§Œë“¤ì–´ì§ˆ ìˆ˜ ìˆìŒ
4. ì‹±ê¸€í†¤ì˜ ì‚¬ìš©ì€ ì „ì—­ ìƒíƒœë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŒ
   - ìŠ¤íƒœí‹± í•„ë“œì´ê¸° ë•Œë¬¸ì— ì–¸ì œë“ ì§€ ì ‘ê·¼ì´ ìš©ì´í•´ì§. ì¦‰, ì•„ë¬´ ê°ì²´ë‚˜ ììœ ë¡­ê²Œ ì ‘ê·¼í•˜ê³  ìˆ˜ì •ì´ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤.

**ì‹±ê¸€í†¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬**

ì´ëŸ° í•œê³„ì—ë„ ë¶ˆê°€ í•˜ê³  ìŠ¤í”„ë§ì€ ì‹±ê¸€í†¤ ì‚¬ìš©ì„ ì ê·¹ ê¶Œì¥í•©ë‹ˆë‹¤. í•œê³„ë¥¼ ê·¹ë³µí•˜ê¸° ìœ„í•´ ìŠ¤í”„ë§ì´ ì§ì ‘ ì‹±ê¸€í†¤í˜•íƒœì˜ ì˜¤ë¸Œì íŠ¸ë¥¼ ë§Œë“¤ê³  ê´€ë¦¬í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
ê·¸ê²ƒì„ ë°”ë¡œ **ì‹±ê¸€í†¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬**ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.

ì‹±ê¸€í†¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ëŠ” ìŠ¤íƒœí‹± í•„ë“œì™€ private ìƒì„±ìë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  í‰ë²”í•œ ìë°” í´ë˜ìŠ¤ë¥¼ ì‹±ê¸€í†¤ìœ¼ë¡œ í™œìš©í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.
ë•ë¶„ì— ì‹±ê¸€í†¤ ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©ë­ ì• í”Œë¦¬ì¼€ì´ì…˜ í´ë˜ìŠ¤ë¼ë„ public ìƒì„±ìë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ğŸ”§ ì‹±ê¸€í†¤ê³¼ ì˜¤ë¸Œì íŠ¸ì˜ ìƒíƒœ

ì‹±ê¸€í†¤ì€ ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì´ë¼ë©´ ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ì ‘ê·¼í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ìƒíƒœê´€ë¦¬ì— ì£¼ì˜ë¥¼ ê¸°ìš¸ì—¬ì•¼ í•©ë‹ˆë‹¤.
ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ì„œë¹„ìŠ¤ í˜•íƒœì˜ ì˜¤ë¸Œì íŠ¸ë¡œ ì‚¬ìš©ë˜ëŠ” ê²½ìš°ì—ëŠ” ìƒíƒœì •ë³´ë¥¼ ë‚´ë¶€ì— ê°–ê³  ìˆì§€ ì•Šì€ ë¬´ìƒíƒœ ë°©ì‹ìœ¼ë¡œ ë§Œë“¤ì–´ì ¸ì•¼ í•©ë‹ˆë‹¤.

ì™œëƒí•˜ë©´, ì‹±ê¸€í†¤ìœ¼ë¡œ ìœ ì§€ì‹œ ì €ì¥í•  ê³µê°„ì€ í•˜ë‚˜ ë¿ì´ë‹ˆ ì›ì¹˜ì•Šì€ ê°’ì„ ì½ì„ ìˆ˜ ë„ ìˆê³ , ë®ì–´ ì“¸ìˆ˜ë„ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
ë¬¼ë¡ , ì½ê¸°ì „ìš©ì˜ ê°’ì´ë¼ë©´ ì´ˆê¸°í™” ì‹œì ì—ì„œ ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ì— ì €ì¥í•´ë‘ê³  ê³µìœ í•˜ëŠ” ê²ƒì€ ì•„ë¬´ëŸ° ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.

ê·¸ë ‡ë‹¤ë©´, ê° ìš”ì²­ì— ëŒ€í•œ ì •ë³´ë‚˜, ë¦¬ì†ŒìŠ¤ë¡œë¶€í„° ìƒì„±í•œ ì •ë³´ê°€ í•„ìš”í•œ ê²½ìš°ëŠ”?? ì´ë–„ëŠ” íŒŒë¼ë¯¸í„°, ë¡œì»¬ ë³€ìˆ˜, ë¦¬í„´ ê°’ë“±ì„ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.

***

## ğŸš€ ì˜ì¡´ê´€ê³„ ì£¼ì…(DI)

### ğŸ”§ ëŸ°íƒ€ì„ ì˜ì¡´ê´€ê³„ ì„¤ì •

ì˜ì¡´ê´€ê³„ë€ ë¬´ì—‡ì¼ê¹Œìš”??

ë‘ ê°œì˜ í´ë˜ìŠ¤ ë˜ëŠ” ëª¨ë“ˆì´ ì˜ì¡´ê´€ê³„ì— ìˆë‹¤ê³  ë§í•  ë•ŒëŠ” í•­ìƒ ë°©í–¥ì„±ì„ ë¶€ì—¬í•´ì•¼í•©ë‹ˆë‹¤.
ì¦‰, ëˆ„ê°€ ëˆ„êµ¬ì—ê²Œ ì˜ì¡´í•˜ëŠ” ê´€ê³„ì— ìˆë‹¤ëŠ” ì‹ì´ì–´ì•¼ í•©ë‹ˆë‹¤.

**ex) A í´ë˜ìŠ¤ -> B í´ë˜ìŠ¤ ë¼ëŠ” ì˜ì¡´ê´€ê³„ê°€ ìˆë‹¤ê³  ìƒê°í•´ë´…ì‹œë‹¤.**

ì—¬ê¸°ì„œëŠ” Bê°€ ë³€í•˜ë©´ Aì—ê²Œ ì˜í–¥ì„ ë¯¸ì¹œë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤. Bì˜ ê¸°ëŠ¥ì´ ì¶”ê°€ë˜ê±°ë‚˜ ë³€ê²½ëœë‹¤ë©´ ê·¸ ì˜í–¥ì´ Aë¡œ ì „ë‹¬ëœë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.
ëŒ€í‘œì ìœ¼ë¡œ Aê°€ Bë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, Aì—ì„œ Bì— ì •ì˜ëœ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•´ì„œ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ë¥¼ `ì‚¬ìš©ë° ëŒ€í•œ ì˜ì¡´ê´€ê³„`ë¼ê³  í•©ë‹ˆë‹¤.

**`service`í´ë˜ìŠ¤ì˜ ì˜ì¡´ê´€ê³„**

**UserRepositoryV5.java**
```java
public interface UserRepositoryV5 {

    Long save(User user);
    Optional<User> findById(Long userId);
    void remove(Long userId);
}

```

**UserRepositoryV5Impl.java**
```java
@RequiredArgsConstructor
public class UserRepositoryV5Impl implements UserRepositoryV5 {

    private final EntityManager em;

    @Override
    public Long save(User user) {
        em.persist(user);
        return user.getId();
    }

    @Override
    public Optional<User> findById(Long userId) {
        return Optional.ofNullable(em.find(User.class,userId));
    }

    @Override
    public void remove(Long userId) {
        User findUser = findById(userId).orElse(null);
        if(findUser==null)
            throw  new IllegalArgumentException();
        em.remove(findUser);
    }

}
```

**UserServiceV5.java**
```java
@Transactional
public class UserServiceV5 {

    private final UserRepositoryV5 userRepositoryV5;

    public UserServiceV5(UserRepositoryV5 userRepositoryV5) {
        this.userRepositoryV5 = userRepositoryV5;
    }

    public Long join(User user){
        return userRepositoryV5.save(user);
    }

    public User findOne(Long userId){
        Optional<User> findUser=userRepositoryV5.findById(userId);

        return findUser.orElseThrow(()->{
                    throw new RuntimeException();
                }
        );
    }
}
```

ê·¸ëŸ¼ ì´ˆê¸°ì— ë§Œë“¤ì—ˆë˜ `service` í´ë˜ìŠ¤ì™€ `repository`ì¸í„°í˜ì´ìŠ¤ê°„ì˜ ì˜ˆë¥¼ ë´…ì‹œë‹¤.
`service` í´ë˜ìŠ¤ëŠ” `repository`ë¥¼ ì˜ì¡´í•˜ê³  ìˆëŠ” í˜•íƒœì…ë‹ˆë‹¤.
ë”°ë¼ì„œ `repository` ì¸í„°í˜ì´ìŠ¤ê°€ ë³€í•˜ê²Œëœë‹¤ë©´, `service`ê°€ ì§ì ‘ì ì¸ ì˜í–¥ì„ ë°›ê²Œ ë©ë‹ˆë‹¤.
í•˜ì§€ë§Œ, ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³  ìˆëŠ” `repositoryImpl` í´ë˜ìŠ¤ê°€ ë³€í•˜ê²Œ ëœë‹¤ë©´, ë°›ëŠ” ì˜í–¥ì€ ì—†ìŠµë‹ˆë‹¤.

ì´ë ‡ê²Œ, ì¸í„°í˜ì´ìŠ¤ì— ëŒ€í•´ì„œë§Œ ì˜ì¡´ê´€ê³„ë¥¼ ë§Œë“¤ì–´ë‘ë©´ ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ í´ë˜ìŠ¤ì™€ì˜ ê´€ê³„ëŠ” ëŠìŠ¨í•´ì§€ë©´ì„œ ë³€í™”ì— ì˜í–¥ì„ ëœ ë°›ëŠ” ìƒíƒœê°€ ë©ë‹ˆë‹¤.

`service` í´ë˜ìŠ¤ëŠ” `repository`ì¸í„°í˜ì´ìŠ¤ì—ê²Œë§Œ ì˜ì¡´í•œë‹¤ê³  ë³¼ ìˆ˜ ë„ ìˆëŠ” í˜•íƒœì…ë‹ˆë‹¤.
`service`ëŠ” êµ¬í˜„ì²´ì˜ ì¡´ì¬ë„ ì•Œì§€ ëª»í•˜ëŠ” ìƒí™©ì…ë‹ˆë‹¤.

ê·¸ëŸ°ë°, ëª¨ë¸ì´ë‚˜ ì½”ë“œì—ì„œ í´ë˜ìŠ¤ì™€ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ë“œëŸ¬ë‚˜ëŠ” ì˜ì¡´ê´€ê³„ ë§ê³ , ëŸ°íƒ€ì„ ì‹œì— ì˜¤ë¸Œì íŠ¸ ì‚¬ì´ì—ì„œ ë§Œë“¤ì–´ì§€ëŠ” ì˜ì¡´ê´€ê³„ë„ ìˆìŠµë‹ˆë‹¤.
ì´ë¥¼ `ëŸ°íƒ€ì„ ì˜ì¡´ê´€ê³„`ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤. ì¦‰, ì„¤ê³„ ì‹œì ì˜ ì˜ì¡´ê´€ê³„ê°€ ì‹¤ì²´í™” ë˜ëŠ” ê²ƒì´ë¼ê³  ë³´ì‹œë©´ ë©ë‹ˆë‹¤.

í”„ë¡œê·¸ë¨ì´ ì‹œì‘ë˜ê³  `service` ì˜¤ë¸Œì íŠ¸ê°€ ë§Œë“¤ì–´ì§€ê³  ë‚˜ì„œ ëŸ°íƒ€ì„ ì‹œì— ì˜ì¡´ê´€ê³„ë¥¼ ë§ºëŠ” ëŒ€ìƒ, ì¦‰ ì‹¤ì œ ì‚¬ìš©ëŒ€ìƒì¸ ì˜¤ë¸Œì íŠ¸ë¥¼ ì˜ì¡´ ì˜¤ë¸Œì íŠ¸ë¼ê³  ë§í•©ë‹ˆë‹¤.

**ëŸ°íƒ€ì„ ì‹œì  ì˜ì¡´ê´€ê³„**
- ì»¨í…Œì´ë„ˆë‚˜ íŒ©í† ë¦¬ ê°™ì€ ì œ3ì˜ ì¡´ì¬ê°€ ê²°ì •í•©ë‹ˆë‹¤.
  - ì„¤ê³„ ì‹œì ì—ì„œëŠ” ì•Œì§€ ëª»í–ˆë˜ ë‘ ì˜¤ë¸Œì íŠ¸ì˜ ê´€ê³„ë¥¼ ë§ºë„ë¡ (`service`ì™€ `repositoryImpl`) ë„ì™€ì£¼ëŠ” ì œ 3ì˜ ì¡´ì¬
  - DIì—ì„œ ë§í•˜ëŠ” ì œ3ì˜ ì¡´ì¬ëŠ” ë°”ë¡œ ê´€ê³„ì„¤ì • ì±…ì„ì„ ê°€ì§„ ì½”ë“œë¥¼ ë¶„ë¦¬í•´ì„œ ë§Œë“¤ì–´ì§€ëŠ” ì˜¤ë¸Œì íŠ¸ 
    - ìŠ¤í”„ë§ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸, IOCì»¨í…Œì´ë„ˆ
- ì˜ì¡´ê´€ê³„ëŠ” ì‚¬ìš©í•  ì˜¤ë¸Œì íŠ¸ì— ëŒ€í•œ ë ˆí¼ëŸ°ìŠ¤ë¥¼ ì™¸ë¶€ì—ì„œ ì œê³µí•´ì¤Œìœ¼ë¡œì¨ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤.
  
**AppConfig.java**
```java
@Configuration
public class SpringAppConfigV1 {

    @Bean
    @Primary
    public LocalEntityManagerFactoryBean getEmf(){
        LocalEntityManagerFactoryBean emf=new LocalEntityManagerFactoryBean();
        emf.setPersistenceUnitName("hello");
        return emf;
    }

    @Bean
    @Primary
    public EntityManager getEm(){
        return getEmf().getObject().createEntityManager();
    }

    @Bean
    public UserRepositoryV5 userRepository(){
        return new UserRepositoryV5Impl(getEm());
    }

    @Bean
    public UserServiceV5 userService(){
        return new UserServiceV5(userRepository());
    }
}
```

ìœ„ì˜ ì½”ë“œëŠ” ëŸ°íƒ€ì„ ì‹œì ì— `service`ê°€ ì‚¬ìš©í•  `repository` íƒ€ì…ì˜ ì˜¤ë¸Œì íŠ¸ë¥¼ ê²°ì •í•˜ê³  ì´ë¥¼ ìƒì„±í•œ í›„ì— `service`ì˜ íŒŒë¼ë¯¸í„°ë¡œ ì£¼ì…í•´ì„œ
êµ¬í˜„ì²´ì™€ì˜ ëŸ°íƒ€ì„ ì˜ì¡´ê´€ê³„ë¥¼ ë§ºê²Œ í•´ì¤ë‹ˆë‹¤.
ë˜í•œ, IoCë°©ì‹ìœ¼ë¡œ ì˜¤ë¸Œì íŠ¸ì˜ ìƒì„±ê³¼ ì´ˆê¸°í™”, ì œê³µë“±ì˜ ì‘ì—…ë“±ë„ ìˆ˜í–‰í•˜ê³  ìˆìœ¼ë¯€ë¡œ IoC/DI ì»¨í…Œì´ë„ˆë¼ê³  ë§ì´ ë¶€ë¦…ë‹ˆë‹¤.

DIì»¨í…Œì´ë„ˆì— ì˜í•´ ëŸ°íƒ€ì„ ì‹œì— ì˜ì¡´ ì˜¤ë¸Œì íŠ¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ê·¸ ë ˆí¼ëŸ°ìŠ¤ë¥¼ ì „ë‹¬ë°›ëŠ” ê³¼ì •ì´ ë§ˆì¹˜ ë©•ì†Œë“œë¥¼ í†µí•´ DI ì»¨í…Œì´ë„ˆê°€ `service`ì— ì£¼ì…í•´ì£¼ëŠ” ê²ƒê³¼ ê°™ë‹¤ê³  í•´ì„œ
ì´ë¥¼ ã…‡ì˜ì¡´ê´€ê³„ ì£¼ì…ì´ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.

### ğŸ”§ ì˜ì¡´ê´€ê³„ ê²€ìƒ‰ê³¼ ì£¼ì…

ì˜ì¡´ê´€ê³„ë¥¼ ë§ºëŠ” ë°©ë²•ì´ ì™¸ë¶€ë¡œë¶€í„°ì˜ ì£¼ì…ì´ ì•„ë‹ˆë¼ ìŠ¤ìŠ¤ë¡œ ê²€ìƒ‰ì„ ì´ìš©í•˜ê¸° ë•Œë¬¸ì— ì˜ì¡´ê´€ê³„ ê²€ìƒ‰ì´ë¼ê³  ë¶ˆë¦½ë‹ˆë‹¤.

ì˜ì¡´ê´€ê³„ ê²€ìƒ‰ì€ ìì‹ ì´ í•„ìš”ë¡œ í•˜ëŠ” ì˜ì¡´ ì˜¤ë¸Œì íŠ¸ë¥¼ ëŠ¥ë™ì ìœ¼ë¡œ ì°¾ìŠµë‹ˆë‹¤. ì–´ë–¤ êµ¬í˜„ì²´ë¥¼ ì‚¬ìš©í• ì§€ëŠ” ê²°ì •í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
ì˜ì¡´ê´€ê³„ë¥¼ ë§ºì„ ì˜¤ë¸Œì íŠ¸ë¥¼ ê²°ì •í•˜ëŠ” ê²ƒê³¼ ì˜¤ë¸Œì íŠ¸ì˜ ìƒì„±ì‘ì—…ì€ ì™¸ë¶€ ì»¨í…Œì´ë„ˆì—ê²Œ IoCë¡œ ë§¡ê¸°ì§€ë§Œ, ì´ë¥¼ ê°€ì ¸ì˜¬ ë•ŒëŠ” ë©”ì†Œë“œë‚˜ ìƒì„±ìë¥¼ í†µí•œ
ì£¼ì… ëŒ€ì‹  ìŠ¤ìŠ¤ë¡œ ì»¨í…Œì´ë„ˆì—ê²Œ ìš”ì²­í•˜ëŠ” ë°©ë²•ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

**UserServiceV6.java**

```java
@Transactional
public class UserServiceV6 {
    private final UserRepositoryV5 userRepositoryV5;

    public UserServiceV6() {
        AnnotationConfigApplicationContext ac=new AnnotationConfigApplicationContext(SpringAppConfigV1.class);
        this.userRepositoryV5 = ac.getBean("userRepository",UserRepositoryV5.class);
    }

    public Long join(User user){
        return userRepositoryV5.save(user);
    }

    public User findOne(Long userId){
        Optional<User> findUser=userRepositoryV5.findById(userId);

        return findUser.orElseThrow(()->{
                    throw new RuntimeException();
                }
        );
    }
}
```


**í…ŒìŠ¤íŠ¸**

```java
@SpringBootTest
@Transactional
public class UserServiceV6Test {

    UserServiceV6 userService=new UserServiceV6();

    @Test
    @DisplayName("ì˜ì¡´ê´€ê³„ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸")
    void ì˜ì¡´ê´€ê³„_ê²€ìƒ‰(){
        User user=createUser("hong","1234");

        Long saveId = userService.join(user);

        User findUser = userService.findOne(saveId);

        Assertions.assertThat(findUser.getName()).isEqualTo(user.getName());
    }

    private User createUser(String name, String password){
        return User.createUser()
                .name(name)
                .password(password)
                .build();
    }
}
```

**ë™ì‘ í™•ì¸**

<img width="50%" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-10-14 á„‹á…©á„Œá…¥á†« 1 54 31" src="https://user-images.githubusercontent.com/56334761/137178611-5f3f0fef-2e0e-4362-8563-e5e782943a97.png">

ì½”ë“œë¥¼ ë³´ì‹œë©´ ì™¸ë¶€ë¡œ ë¶€í„° ì˜ì¡´ê´€ê³„ë¥¼ ì£¼ì… ë°›ëŠ” ê²ƒì´ ì•„ë‹Œ ìŠ¤ìŠ¤ë¡œ IoC ì»¨í…Œì´ë„ˆì—ê²Œ ìš”ì²­ì„ í•©ë‹ˆë‹¤.

**ì˜ì¡´ê´€ê³„ ê²€ìƒ‰ê³¼ ì£¼ì…ì˜ ì°¨ì´ì **

- ê²€ìƒ‰ ë°©ì‹
  - ìì‹ ì´ ìŠ¤í”„ë§ì˜ ë¹ˆì¼ í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.
  - ê·¸ëƒ¥ ì§ì ‘ new ë¡œ ìƒì„±í•´ë„ ë©ë‹ˆë‹¤.
- ì£¼ì… ë°©ì‹
  - ìì‹ ë„ ë°˜ë“œì‹œ ë¹ˆì´ì–´ì•¼ í•©ë‹ˆë‹¤.
    - ì»¨í…Œì´ë„ˆê°€ ì˜¤ë¸Œì íŠ¸ë¥¼ ì£¼ì…í•˜ê¸° ìœ„í•´ì„œëŠ” ìƒì„±ê³¼ ì´ˆê¸°í™” ê¶Œí•œì„ ê°–ê³  ìˆì–´ì•¼í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

**ì˜ì¡´ê´€ê³„ ê²€ìƒ‰ ë°©ë²•ì€ ì ì–´ë„ í•œë²ˆì´ìƒì€ ì“°ì…ë‹ˆë‹¤**

ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹œì‘ë˜ëŠ” ì‹œì ì—ì„œ ìŠ¤íƒœí‹± ë©”ì†Œë“œì¸ main()ì€ DIë¥¼ ì´ìš©í•˜ì—¬ ì˜¤ë¸Œì íŠ¸ë¥¼ ì£¼ì…ë°›ì„ ë°©ë²•ì´ ì—†ê¸°ë•Œë¬¸ì…ë‹ˆë‹¤.

ì„œë²„ì—ì„œë„ ì˜ì¡´ê´€ê³„ ê²€ìƒ‰ ë°©ë²•ì´ ì‚¬ìš©ë©ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ìš”ì²­ì„ ë°›ì„ ë•Œë§ˆë‹¤ DispatcherServlet ì—ì„œ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ë‹´ê¸´ ì˜¤ë¸Œì íŠ¸ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ ì…ë‹ˆë‹¤.